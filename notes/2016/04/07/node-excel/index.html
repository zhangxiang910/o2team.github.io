<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Node读写Excel文件探究实践 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="Node-Excel-Export,JS-XLSX,excel,node,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2016/04/07/node-excel/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="简介本文介绍用 Node.js 中的依赖库来处理 Excel 文件，深入分析对比常见npm库处理Excel 文件存在的优缺点，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。  思路 有哪些外部模块支持读写Excel 引入依赖模块 编写业务逻辑函数 实践应用  支持读写Excel的node.js模块通过npm搜索，支持读写excel文件的模块有很多，但是都各有忧缺点"><meta name="keywords" content="node,excel,JS-XLSX,Node-Excel-Export"><meta property="og:type" content="article"><meta property="og:title" content="Node读写Excel文件探究实践"><meta property="og:url" content="https://aotu.io/notes/2016/04/07/node-excel/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="简介本文介绍用 Node.js 中的依赖库来处理 Excel 文件，深入分析对比常见npm库处理Excel 文件存在的优缺点，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。  思路 有哪些外部模块支持读写Excel 引入依赖模块 编写业务逻辑函数 实践应用  支持读写Excel的node.js模块通过npm搜索，支持读写excel文件的模块有很多，但是都各有忧缺点"><meta property="og:locale" content="zh-cn"><meta property="og:updated_time" content="2020-04-28T03:04:50.291Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Node读写Excel文件探究实践"><meta name="twitter:description" content="简介本文介绍用 Node.js 中的依赖库来处理 Excel 文件，深入分析对比常见npm库处理Excel 文件存在的优缺点，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。  思路 有哪些外部模块支持读写Excel 引入依赖模块 编写业务逻辑函数 实践应用  支持读写Excel的node.js模块通过npm搜索，支持读写excel文件的模块有很多，但是都各有忧缺点"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="https://img30.360buyimg.com/ling/jfs/t1/43845/18/6878/48372/5d0856d1Ef76392ea/8b485a3ad42b173f.png" alt="Node读写Excel文件探究实践"></div><header class="post-hd"><h1 class="post-tit">Node读写Excel文件探究实践</h1><div class="post-meta">by <a target="_blank" href="https://github.com/pfan123" class="post-author">高大师</a> on <span>2016-04-07</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>本文介绍用 Node.js 中的依赖库来处理 Excel 文件，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><h2 id="简介" class="post-heading"><a href="#简介" class="headerlink" title="简介"></a>简介<a class="post-anchor" href="#简介" aria-hidden="true"></a></h2><p>本文介绍用 Node.js 中的依赖库来处理 Excel 文件，深入分析对比常见npm库处理Excel 文件存在的优缺点，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。</p><h2 id="思路" class="post-heading"><a href="#思路" class="headerlink" title="思路"></a>思路<a class="post-anchor" href="#思路" aria-hidden="true"></a></h2><ul><li>有哪些外部模块支持读写Excel</li><li>引入依赖模块</li><li>编写业务逻辑函数</li><li>实践应用</li></ul><h2 id="支持读写Excel的node-js模块" class="post-heading"><a href="#支持读写Excel的node-js模块" class="headerlink" title="支持读写Excel的node.js模块"></a>支持读写Excel的node.js模块<a class="post-anchor" href="#支持读写Excel的node-js模块" aria-hidden="true"></a></h2><p>通过npm搜索，支持读写excel文件的模块有很多，但是都各有忧缺点，有些仅支持xls/xlsx的一种格式，有些仅支持读取数据，有些仅支持导出文件，有些需要依赖python解析。常见的npm依赖模块如下：</p><blockquote><ul><li><a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="noopener">js-xlsx</a>: 目前 Github 上 star 数量最多的处理 Excel 的库，支持解析多种格式表格XLSX / XLSM / XLSB / XLS / CSV，解析采用纯js实现，写入需要依赖nodejs或者<a href="https://github.com/eligrey/FileSaver.js/" target="_blank" rel="noopener">FileSaver</a>.js实现生成写入Excel，可以生成子表Excel，功能强大，但上手难度稍大。不提供基础设置Excel表格api例单元格宽度，文档有些乱，不适合快速上手；</li><li><a href="https://github.com/mgcrea/node-xlsx" target="_blank" rel="noopener">node-xlsx</a>: 基于Node.js解析excel文件数据及生成excel文件，仅支持xlsx格式文件；</li><li><a href="https://github.com/leftshifters/excel-parser" target="_blank" rel="noopener">excel-parser</a>: 基于Node.js解析excel文件数据，支持xls及xlsx格式文件，需要依赖python，太重不太实用；</li><li><a href="https://github.com/functionscope/Node-Excel-Export" target="_blank" rel="noopener">excel-export</a> : 基于Node.js将数据生成导出excel文件，生成文件格式为xlsx，可以设置单元格宽度，API容易上手，无法生成worksheet字表，比较单一，基本功能可以基本满足；</li><li><a href="https://segmentfault.com/a/1190000004062768" target="_blank" rel="noopener">node-xlrd</a>: 基于node.js从excel文件中提取数据，仅支持xls格式文件,不支持xlsx,有点过时，常用的都是XLSX 格式。</li></ul></blockquote><p>通过以上分析对比，本人比较推崇<code>js-xlsx</code>、<code>excel-export</code>来读写Excel文件，可以结合使用<code>js-xlsx</code>解析Excel、<code>excel-export</code>生成，效果更加，接下来分别实践<code>js-xlsx</code>、<code>excel-export</code>。</p><h2 id="第一讲：利用-js-xlsx-处理-Excel-文件" class="post-heading"><a href="#第一讲：利用-js-xlsx-处理-Excel-文件" class="headerlink" title="第一讲：利用 js-xlsx 处理 Excel 文件"></a>第一讲：利用 js-xlsx 处理 Excel 文件<a class="post-anchor" href="#第一讲：利用-js-xlsx-处理-Excel-文件" aria-hidden="true"></a></h2><h3 id="安装" class="post-heading"><a href="#安装" class="headerlink" title="安装"></a>安装<a class="post-anchor" href="#安装" aria-hidden="true"></a></h3><p>node中使用通过npm：<br></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> xlsx</span><br></pre></td></tr></table></figure><p></p><p>浏览器使用：<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"javascript"</span> <span class="attr">src</span>=<span class="string">"dist/xlsx.core.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>通过bower安装：<br></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bower </span><span class="keyword">install </span><span class="keyword">js-xlsx</span></span><br></pre></td></tr></table></figure><p></p><p><code>注意</code>，在客户端使用时，建议使用<code>dist/xlsx.full.min.js</code>，包含了js-xlsx所有模块。</p><h3 id="一些概念" class="post-heading"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念<a class="post-anchor" href="#一些概念" aria-hidden="true"></a></h3><p>在使用这个库之前，先介绍库中的一些概念。</p><blockquote><ul><li>workbook 对象，指的是整份 Excel 文档。我们在使用 js-xlsx 读取 Excel 文档之后就会获得 workbook 对象。</li><li>worksheet 对象，指的是 Excel 文档中的表。我们知道一份 Excel 文档中可以包含很多张表，而每张表对应的就是 worksheet 对象。</li><li>cell 对象，指的就是 worksheet 中的单元格，一个单元格就是一个 cell 对象。</li></ul></blockquote><p>它们的关系如下：<br></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// workbook</span></span><br><span class="line">&#123;</span><br><span class="line">    SheetNames: ['sheet1', 'sheet2'],</span><br><span class="line">    Sheets: &#123;</span><br><span class="line">        <span class="comment">// worksheet</span></span><br><span class="line">        'sheet1': &#123;</span><br><span class="line">            <span class="comment">// cell</span></span><br><span class="line">            'A1': &#123; ... &#125;,</span><br><span class="line">            <span class="comment">// cell</span></span><br><span class="line">            'A2': &#123; ... &#125;,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// worksheet</span></span><br><span class="line">        'sheet2': &#123;</span><br><span class="line">            <span class="comment">// cell</span></span><br><span class="line">            'A1': &#123; ... &#125;,</span><br><span class="line">            <span class="comment">// cell</span></span><br><span class="line">            'A2': &#123; ... &#125;,</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="用法" class="post-heading"><a href="#用法" class="headerlink" title="用法"></a>用法<a class="post-anchor" href="#用法" aria-hidden="true"></a></h3><p><strong>基本用法</strong></p><p>1.用 <code>XLSX.read</code> 读取获取到的 Excel 数据，返回 workbook<br>2.用 <code>XLSX.readFile</code> 打开 Excel 文件，返回 workbook<br>3.用 <code>workbook.SheetNames</code> 获取表名<br>4.用 <code>workbook.Sheets[xxx]</code> 通过表名获取表格<br>5.用 <code>worksheet[address]</code>操作单元格<br>6.用<code>XLSX.utils.sheet_to_json</code>针对单个表获取表格数据转换为json格式<br>7.用<code>XLSX.writeFile(wb, &#39;output.xlsx&#39;)</code>生成新的 Excel 文件</p><p><strong>具体用法</strong><br>读取 Excel 文件<br></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">workbook ＝ <span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>read(excelData, &#123;<span class="keyword">type</span>: 'base64'&#125;);</span><br><span class="line">workbook ＝ <span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>write<span class="constructor">File('<span class="params">someExcel</span>.<span class="params">xlsx</span>', <span class="params">opts</span>)</span>;</span><br></pre></td></tr></table></figure><p></p><p>获取 Excel 文件中的表<br></p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 Excel 中所有表名</span></span><br><span class="line"><span class="keyword">var</span> sheetNames = workbook.SheetNames; <span class="comment">// 返回 ['sheet1', 'sheet2',……]</span></span><br><span class="line"><span class="comment">// 根据表名获取对应某张表</span></span><br><span class="line"><span class="keyword">var</span> worksheet = workbook.Sheets[sheetNames[<span class="number">0</span>]];</span><br></pre></td></tr></table></figure><p></p><p>通过 <code>worksheet[address]</code> 来操作表格，以 ! 开头的 key 是特殊的字段。<br></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">获取</span> <span class="string">A1</span> <span class="string">单元格对象</span></span><br><span class="line"><span class="string">let</span> <span class="string">a1</span> <span class="string">=</span> <span class="string">worksheet['A1'];</span> <span class="string">//</span> <span class="string">返回</span> <span class="string">&#123;</span> <span class="attr">v:</span> <span class="string">'hello'</span><span class="string">,</span> <span class="attr">t:</span> <span class="string">'s'</span><span class="string">,</span> <span class="string">...</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">//</span> <span class="string">获取</span> <span class="string">A1</span> <span class="string">中的值</span></span><br><span class="line"><span class="string">a1.v</span> <span class="string">//</span> <span class="string">返回</span> <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">获取表的有效范围</span></span><br><span class="line"><span class="string">worksheet['!ref']</span> <span class="string">//</span> <span class="string">返回</span> <span class="string">'A1:B20'</span></span><br><span class="line"><span class="string">worksheet['!range']</span> <span class="string">//</span> <span class="string">返回</span> <span class="string">range</span> <span class="string">对象，&#123;</span> <span class="attr">s:</span> <span class="string">&#123;</span> <span class="attr">r:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">c:</span> <span class="number">0</span><span class="string">&#125;,</span> <span class="attr">e:</span> <span class="string">&#123;</span> <span class="attr">r:</span> <span class="number">100</span><span class="string">,</span> <span class="attr">c:</span> <span class="number">2</span> <span class="string">&#125;</span> <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">获取合并过的单元格</span></span><br><span class="line"><span class="string">worksheet['!merges']</span> <span class="string">//</span> <span class="string">返回一个包含</span> <span class="string">range</span> <span class="string">对象的列表，[</span> <span class="string">&#123;s:</span> <span class="string">&#123;</span> <span class="attr">r:</span> <span class="number">0</span><span class="string">,</span> <span class="attr">c:</span> <span class="number">0</span> <span class="string">&#125;,</span> <span class="attr">c:</span> <span class="string">&#123;</span> <span class="attr">r:</span> <span class="number">2</span><span class="string">,</span> <span class="attr">c:</span> <span class="number">1</span> <span class="string">&#125;</span> <span class="string">&#125;</span> <span class="string">]</span></span><br></pre></td></tr></table></figure><p></p><p>获取 Excel 文件中的表转换为json数据<br></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>utils.sheet<span class="constructor">_to_json(<span class="params">worksheet</span>)</span>  <span class="comment">//针对单个表，返回序列化json数据</span></span><br></pre></td></tr></table></figure><p></p><p>生成新的 Excel 文件<br></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务端通过XLSX.writeFile</span></span><br><span class="line">XLSX = require(<span class="string">"xlsx"</span>);</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>write<span class="constructor">File(<span class="params">wb</span>, '<span class="params">output</span>.<span class="params">xlsx</span>')</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment">//客服端，只能通过XLSX.write(wb, write_opts) 写入 表格数据，借助FileSaver生成，且只支持在高版本浏览器。</span></span><br><span class="line">var wopts = &#123; bookType:'xlsx', bookSST:<span class="literal">false</span>, <span class="keyword">type</span>:'binary' &#125;;</span><br><span class="line"></span><br><span class="line">var wbout = <span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>write(wb,wopts);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> s2ab(s) &#123;</span><br><span class="line">  var buf = <span class="keyword">new</span> <span class="constructor">ArrayBuffer(<span class="params">s</span>.<span class="params">length</span>)</span>;</span><br><span class="line">  var view = <span class="keyword">new</span> <span class="constructor">Uint8Array(<span class="params">buf</span>)</span>;</span><br><span class="line">  for (var i=<span class="number">0</span>; i!=s.length; ++i) view<span class="literal">[<span class="identifier">i</span>]</span> = s.<span class="built_in">char</span><span class="constructor">CodeAt(<span class="params">i</span>)</span> &amp; <span class="number">0xFF</span>;</span><br><span class="line">  return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* the saveAs call downloads a file on the local machine */</span></span><br><span class="line">save<span class="constructor">As(<span class="params">new</span> Blob([<span class="params">s2ab</span>(<span class="params">wbout</span>)</span>],&#123;<span class="keyword">type</span>:<span class="string">""</span>&#125;), <span class="string">"test.xlsx"</span>)</span><br></pre></td></tr></table></figure><p></p><h2 id="js-xlsx实战" class="post-heading"><a href="#js-xlsx实战" class="headerlink" title="js-xlsx实战"></a>js-xlsx实战<a class="post-anchor" href="#js-xlsx实战" aria-hidden="true"></a></h2><p><strong>解析 Excel 生成 JSON</strong><br></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="keyword">to</span><span class="constructor">_json(<span class="params">workbook</span>)</span> &#123;</span><br><span class="line">	var result = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取 Excel 中所有表名</span></span><br><span class="line">	var sheetNames = workbook.SheetNames; <span class="comment">// 返回 ['sheet1', 'sheet2']</span></span><br><span class="line"></span><br><span class="line">	workbook.<span class="module-access"><span class="module"><span class="identifier">SheetNames</span>.</span></span>for<span class="constructor">Each(<span class="params">function</span>(<span class="params">sheetName</span>)</span> &#123;</span><br><span class="line">		var worksheet = workbook.Sheets<span class="literal">[<span class="identifier">sheetName</span>]</span>;</span><br><span class="line">		result<span class="literal">[<span class="identifier">sheetName</span>]</span> = <span class="module-access"><span class="module"><span class="identifier">XLSX</span>.</span></span>utils.sheet<span class="constructor">_to_json(<span class="params">worksheet</span>)</span>;</span><br><span class="line">	&#125;);	</span><br><span class="line"></span><br><span class="line">	console.log(<span class="string">"打印表信息"</span>,<span class="module-access"><span class="module"><span class="identifier">JSON</span>.</span></span>stringify(result, <span class="number">2</span>, <span class="number">2</span>));  <span class="comment">//显示格式&#123;"表1":[],"表2":[]&#125;</span></span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><strong>导出表格</strong><br>1.构建特定的数据结构，通过new Blob如下。<br></p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// workbook</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">SheetNames</span>: [<span class="string">'mySheet'</span>],</span><br><span class="line">    <span class="attribute">Sheets</span>: &#123;</span><br><span class="line">        <span class="string">'mySheet'</span>: &#123;</span><br><span class="line">            <span class="string">'!ref'</span>: <span class="string">'A1:E4'</span>, <span class="comment">// 必须要有这个范围才能输出，否则导出的 excel 会是一个空表</span></span><br><span class="line">            <span class="attribute">A1</span>: &#123; <span class="attribute">v</span>: <span class="string">'id'</span> &#125;,</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>2.调用 XLSX.write， 借助FileSaver中new Blob生成即可。<br></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">var _headers = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>, <span class="string">'country'</span>, <span class="string">'remark'</span>]</span><br><span class="line">var _data = [ &#123; id: <span class="string">'1'</span>,</span><br><span class="line">                name: <span class="string">'test1'</span>,</span><br><span class="line">                age: <span class="string">'30'</span>,</span><br><span class="line">                country: <span class="string">'China'</span>,</span><br><span class="line">                remark: <span class="string">'hello'</span> &#125;,</span><br><span class="line">              &#123; id: <span class="string">'2'</span>,</span><br><span class="line">                name: <span class="string">'test2'</span>,</span><br><span class="line">                age: <span class="string">'20'</span>,</span><br><span class="line">                country: <span class="string">'America'</span>,</span><br><span class="line">                remark: <span class="string">'world'</span> &#125;,</span><br><span class="line">              &#123; id: <span class="string">'3'</span>,</span><br><span class="line">                name: <span class="string">'test3'</span>,</span><br><span class="line">                age: <span class="string">'18'</span>,</span><br><span class="line">                country: <span class="string">'Unkonw'</span>,</span><br><span class="line">                remark: <span class="string">'???'</span> &#125; ];</span><br><span class="line"></span><br><span class="line">var headers = _headers</span><br><span class="line">                <span class="regexp">//</span> 为 _headers 添加对应的单元格位置</span><br><span class="line">                <span class="regexp">//</span> [ &#123; v: <span class="string">'id'</span>, position: <span class="string">'A1'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   &#123; v: <span class="string">'name'</span>, position: <span class="string">'B1'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   &#123; v: <span class="string">'age'</span>, position: <span class="string">'C1'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   &#123; v: <span class="string">'country'</span>, position: <span class="string">'D1'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   &#123; v: <span class="string">'remark'</span>, position: <span class="string">'E1'</span> &#125; ]</span><br><span class="line">                .map((v, i) =&gt; Object.assign(&#123;&#125;, &#123;v: v, position: String.fromCharCode(<span class="number">65</span>+i) + <span class="number">1</span> &#125;))</span><br><span class="line">                <span class="regexp">//</span> 转换成 worksheet 需要的结构</span><br><span class="line">                <span class="regexp">//</span> &#123; A1: &#123; v: <span class="string">'id'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   B1: &#123; v: <span class="string">'name'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   C1: &#123; v: <span class="string">'age'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   D1: &#123; v: <span class="string">'country'</span> &#125;,</span><br><span class="line">                <span class="regexp">//</span>   E1: &#123; v: <span class="string">'remark'</span> &#125; &#125;</span><br><span class="line">                .reduce((prev, <span class="keyword">next</span>) =&gt; Object.assign(&#123;&#125;, prev, &#123;[<span class="keyword">next</span>.position]: &#123;v: <span class="keyword">next</span>.v&#125;&#125;), &#123;&#125;);</span><br><span class="line"></span><br><span class="line">var data = _data</span><br><span class="line">              <span class="regexp">//</span> 匹配 headers 的位置，生成对应的单元格数据</span><br><span class="line">              <span class="regexp">//</span> [ [ &#123; v: <span class="string">'1'</span>, position: <span class="string">'A2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'test1'</span>, position: <span class="string">'B2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'30'</span>, position: <span class="string">'C2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'China'</span>, position: <span class="string">'D2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'hello'</span>, position: <span class="string">'E2'</span> &#125; ],</span><br><span class="line">              <span class="regexp">//</span>   [ &#123; v: <span class="string">'2'</span>, position: <span class="string">'A3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'test2'</span>, position: <span class="string">'B3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'20'</span>, position: <span class="string">'C3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'America'</span>, position: <span class="string">'D3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'world'</span>, position: <span class="string">'E3'</span> &#125; ],</span><br><span class="line">              <span class="regexp">//</span>   [ &#123; v: <span class="string">'3'</span>, position: <span class="string">'A4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'test3'</span>, position: <span class="string">'B4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'18'</span>, position: <span class="string">'C4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'Unkonw'</span>, position: <span class="string">'D4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     &#123; v: <span class="string">'???'</span>, position: <span class="string">'E4'</span> &#125; ] ]</span><br><span class="line">              .map((v, i) =&gt; _headers.map((k, j) =&gt; Object.assign(&#123;&#125;, &#123; v: v[k], position: String.fromCharCode(<span class="number">65</span>+j) + (i+<span class="number">2</span>) &#125;)))</span><br><span class="line">              <span class="regexp">//</span> 对刚才的结果进行降维处理（二维数组变成一维数组）</span><br><span class="line">              <span class="regexp">//</span> [ &#123; v: <span class="string">'1'</span>, position: <span class="string">'A2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'test1'</span>, position: <span class="string">'B2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'30'</span>, position: <span class="string">'C2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'China'</span>, position: <span class="string">'D2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'hello'</span>, position: <span class="string">'E2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'2'</span>, position: <span class="string">'A3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'test2'</span>, position: <span class="string">'B3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'20'</span>, position: <span class="string">'C3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'America'</span>, position: <span class="string">'D3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'world'</span>, position: <span class="string">'E3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'3'</span>, position: <span class="string">'A4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'test3'</span>, position: <span class="string">'B4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'18'</span>, position: <span class="string">'C4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'Unkonw'</span>, position: <span class="string">'D4'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>   &#123; v: <span class="string">'???'</span>, position: <span class="string">'E4'</span> &#125; ]</span><br><span class="line">              .reduce((prev, <span class="keyword">next</span>) =&gt; prev.concat(<span class="keyword">next</span>))</span><br><span class="line">              <span class="regexp">//</span> 转换成 worksheet 需要的结构</span><br><span class="line">              <span class="regexp">//</span>   &#123; A2: &#123; v: <span class="string">'1'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     B2: &#123; v: <span class="string">'test1'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     C2: &#123; v: <span class="string">'30'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     D2: &#123; v: <span class="string">'China'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     E2: &#123; v: <span class="string">'hello'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     A3: &#123; v: <span class="string">'2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     B3: &#123; v: <span class="string">'test2'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     C3: &#123; v: <span class="string">'20'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     D3: &#123; v: <span class="string">'America'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     E3: &#123; v: <span class="string">'world'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     A4: &#123; v: <span class="string">'3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     B4: &#123; v: <span class="string">'test3'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     C4: &#123; v: <span class="string">'18'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     D4: &#123; v: <span class="string">'Unkonw'</span> &#125;,</span><br><span class="line">              <span class="regexp">//</span>     E4: &#123; v: <span class="string">'???'</span> &#125; &#125;</span><br><span class="line">              .reduce((prev, <span class="keyword">next</span>) =&gt; Object.assign(&#123;&#125;, prev, &#123;[<span class="keyword">next</span>.position]: &#123;v: <span class="keyword">next</span>.v&#125;&#125;), &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 合并 headers 和 data</span><br><span class="line">var output = Object.assign(&#123;&#125;, headers, data);</span><br><span class="line"><span class="regexp">//</span> 获取所有单元格的位置</span><br><span class="line">var outputPos = Object.keys(output);</span><br><span class="line"><span class="regexp">//</span> 计算出范围</span><br><span class="line">var ref = outputPos[<span class="number">0</span>] + <span class="string">':'</span> + outputPos[outputPos.length - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 构建 workbook 对象</span><br><span class="line">var wb = &#123;</span><br><span class="line">    SheetNames: [<span class="string">'mySheet'</span>],</span><br><span class="line">    Sheets: &#123;</span><br><span class="line">        <span class="string">'mySheet'</span>: Object.assign(&#123;&#125;, output, &#123; <span class="string">'!ref'</span>: ref &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span> 导出 Excel</span><br><span class="line"><span class="regexp">//</span>XLSX.writeFile(wb, <span class="string">'output.xlsx'</span>);</span><br><span class="line"></span><br><span class="line">var wopts = &#123; bookType:<span class="string">'xlsx'</span>, bookSST:false, type:<span class="string">'binary'</span> &#125;;</span><br><span class="line"></span><br><span class="line">var wbout = XLSX.write(wb,wopts);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> s2ab(s) &#123;</span><br><span class="line">  var buf = new ArrayBuffer(s.length);</span><br><span class="line">  var view = new Uint8Array(buf);</span><br><span class="line">  <span class="keyword">for</span> (var i=<span class="number">0</span>; i!=s.length; ++i) view[i] = s.charCodeAt(i) &amp; <span class="number">0</span>xFF;</span><br><span class="line">  return buf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">/* the saveAs call downloads a file on the local machine */</span></span><br><span class="line">saveAs(new Blob([s2ab(wbout)],&#123;type:<span class="string">""</span>&#125;), <span class="string">"test.xlsx"</span>)</span><br></pre></td></tr></table></figure><p></p><p>实践Demo：<a href="http://doc.pfan123.com/excel.html" target="_blank" rel="noopener">RD快速生成excel表</a></p><h2 id="第二讲：利用-excel-export-生成-Excel-文件" class="post-heading"><a href="#第二讲：利用-excel-export-生成-Excel-文件" class="headerlink" title="第二讲：利用 excel-export 生成 Excel 文件"></a>第二讲：利用 excel-export 生成 Excel 文件<a class="post-anchor" href="#第二讲：利用-excel-export-生成-Excel-文件" aria-hidden="true"></a></h2><p>excel-export模块，上手起来就比较容易了，其中原理是通过修改，修改header 信息、拼接字符串、修改字符集、输出字符串的形式实现的，在部分firefox低版本下载中文名会出现乱码情况。我们只需要按照API设置好数据参数，通过nodeExcel.execute调用执行，系统调用模版”styles.xml”就可以生成Excel文件，比较好的就是，它可以设置单元格的宽度，类型。<br>我们先看看，官方提供的例子：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> nodeExcel = <span class="built_in">require</span>(<span class="string">'excel-export'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/Excel'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> conf =&#123;&#125;;</span><br><span class="line">    conf.stylesXmlFile = <span class="string">"styles.xml"</span>;</span><br><span class="line">    conf.name = <span class="string">"mysheet"</span>;</span><br><span class="line">    conf.cols = [&#123;</span><br><span class="line">        caption:<span class="string">'string'</span>,</span><br><span class="line">        type:<span class="string">'string'</span>,</span><br><span class="line">        beforeCellWrite:<span class="function"><span class="keyword">function</span>(<span class="params">row, cellData</span>)</span>&#123;</span><br><span class="line">             <span class="keyword">return</span> cellData.toUpperCase();</span><br><span class="line">        &#125;,</span><br><span class="line">        width:<span class="number">28.7109375</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        caption:<span class="string">'date'</span>,</span><br><span class="line">        type:<span class="string">'date'</span>,</span><br><span class="line">        beforeCellWrite:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> originDate = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(<span class="number">1899</span>,<span class="number">11</span>,<span class="number">30</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">row, cellData, eOpt</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (eOpt.rowNum%<span class="number">2</span>)&#123;</span><br><span class="line">                    eOpt.styleIndex = <span class="number">1</span>;</span><br><span class="line">                &#125;  </span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    eOpt.styleIndex = <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (cellData === <span class="literal">null</span>)&#123;</span><br><span class="line">                  eOpt.cellType = <span class="string">'string'</span>;</span><br><span class="line">                  <span class="keyword">return</span> <span class="string">'N/A'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">return</span> (cellData - originDate) / (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        caption:<span class="string">'bool'</span>,</span><br><span class="line">        type:<span class="string">'bool'</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        caption:<span class="string">'number'</span>,</span><br><span class="line">         type:<span class="string">'number'</span>              </span><br><span class="line">    &#125;];</span><br><span class="line">    conf.rows = [</span><br><span class="line">        [<span class="string">'pi'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(<span class="number">2013</span>, <span class="number">4</span>, <span class="number">1</span>)), <span class="literal">true</span>, <span class="number">3.14</span>],</span><br><span class="line">        [<span class="string">"e"</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2012</span>, <span class="number">4</span>, <span class="number">1</span>), <span class="literal">false</span>, <span class="number">2.7182</span>],</span><br><span class="line">        [<span class="string">"M&amp;M&lt;&gt;'"</span>, <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.UTC(<span class="number">2013</span>, <span class="number">6</span>, <span class="number">9</span>)), <span class="literal">false</span>, <span class="number">1.61803</span>],</span><br><span class="line">        [<span class="string">"null date"</span>, <span class="literal">null</span>, <span class="literal">true</span>, <span class="number">1.414</span>]  </span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> result = nodeExcel.execute(conf);</span><br><span class="line">    res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/vnd.openxmlformats'</span>);</span><br><span class="line">    res.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + <span class="string">"Report.xlsx"</span>);</span><br><span class="line">    res.end(result, <span class="string">'binary'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Listening on port 3000'</span>);</span><br></pre></td></tr></table></figure><p></p><p><strong>分析生成excel流程：</strong><br>1.配置excel文件名conf.name<br>2.设置表caption，每列单元格数据类型，宽度<br>3.填充表中每行数据conf.rows，nodeExcel.execute生成数据结构，设置头部，拼接生成表</p><p><strong>写在最后，以上仅为个人观点，如有纰漏之处，欢迎各位大侠拍砖！</strong></p><p>参考资料：</p><ul><li><a href="https://github.com/functionscope/Node-Excel-Export" target="_blank" rel="noopener">Node-Excel-Export excel导出</a></li><li><a href="https://segmentfault.com/a/1190000004062768" target="_blank" rel="noopener">node.js读写excel文件</a></li><li><a href="http://www.uedsc.com/js-xlsx.html" target="_blank" rel="noopener">JS-XLSX读取和解析Excel表格文件(xls/xlsx)的JavaScript插件</a></li><li><a href="http://scarletsky.github.io/2016/01/30/nodejs-process-excel/" target="_blank" rel="noopener">在 Node.js 中利用 js-xlsx 处理 Excel 文件</a></li><li><a href="https://segmentfault.com/a/1190000004062768" target="_blank" rel="noopener">node-xlrd</a></li><li><a href="https://github.com/leftshifters/excel-parser" target="_blank" rel="noopener">excel-parser</a></li><li><a href="https://github.com/eligrey/FileSaver.js/" target="_blank" rel="noopener">FileSaver浏览器保存excel</a></li><li><a href="http://stackoverflow.com/questions/30859901/parse-xlsx-with-node-and-create-json" target="_blank" rel="noopener">stackoverflow xlsx相关问题</a></li></ul><div class="post-tags" style="display:none"><a href="/tags/node/">node</a> <a href="/tags/excel/">excel</a> <a href="/tags/JS-XLSX/">JS-XLSX</a> <a href="/tags/Node-Excel-Export/">Node-Excel-Export</a></div><div class="post-categories" style="display:none"><a href="/cates/NodeJS/">NodeJS</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2016/04/07/node-excel/">https://aotu.io/notes/2016/04/07/node-excel/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-04-28T03:04:50.291Z">上次更新：2020-04-28 11:04:50</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2016/04/12/jcloud-opt/" title="前端优化实践总结">前端优化实践总结 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2016/03/31/readable/" title="提升代码的可读性系列(一)--基础篇"><i class="fa fa-chevron-left"></i> 提升代码的可读性系列(一)--基础篇</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxNi8wNC8wNy9ub2RlLWV4Y2VsLw==",owner:"o2team",repo:"o2team.github.io",title:"Node读写Excel文件探究实践",body:"https://aotu.io/notes/2016/04/07/node-excel/index.html\n\n本文介绍用 Node.js 中的依赖库来处理 Excel 文件，主要阐述用js-xlsx、excel-export 库来处理 Excel 文件。",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["pfan123"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>