<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>十分钟打造 3D 物理世界 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="glTF,Cannon.js,Three.js,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2018/10/18/cannonjs/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><meta name="wechat-logo" content="//misc.aotu.io/ONE-SUNDAY/cannonjs/cover_200x200.jpg"><meta name="wechat-title" content="十分钟打造 3D 物理世界"><meta name="wechat-desc" content="Three.js 和 Cannon.js 的介绍与使用以及 glTF 模型格式、开发工具推荐等内容"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="前言在繁忙的业务中，为了缩短设计和开发的周期，我们的 H5 小游戏更多的会采用 2D 的视觉风格，但总是一个风格是很无趣的，所以最近搞了一个 3D 物理游戏的需求，在开发的过程中遇到了不少问题，希望通过这篇文章将关于 Three.js、Cannon.js、模型、工具等基础知识、问题总结分享给大家。 开始 3D 项目之前，首先从选择 3D 框架开始，老牌引擎 Three.js 和微软的 Babyl"><meta name="keywords" content="Three.js,Cannon.js,glTF"><meta property="og:type" content="article"><meta property="og:title" content="十分钟打造 3D 物理世界"><meta property="og:url" content="https://aotu.io/notes/2018/10/18/cannonjs/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="前言在繁忙的业务中，为了缩短设计和开发的周期，我们的 H5 小游戏更多的会采用 2D 的视觉风格，但总是一个风格是很无趣的，所以最近搞了一个 3D 物理游戏的需求，在开发的过程中遇到了不少问题，希望通过这篇文章将关于 Three.js、Cannon.js、模型、工具等基础知识、问题总结分享给大家。 开始 3D 项目之前，首先从选择 3D 框架开始，老牌引擎 Three.js 和微软的 Babyl"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/threejs_babylonjs.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/axes.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/OrthographicCamera.jpg?t=2"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/PerspectiveCamera.jpg?t=2"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/mesh.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/vertex_face.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/material.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/light.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/DirectionalLight.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/HemisphereLight.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/PointLight.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/SpotLight.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/gltf_assets.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/exporter.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/convert.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/animation_clip.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/cannon.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/cannon_demo.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/ray.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/OrbitControls.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/gltf_viewer.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/camera_helper.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/light_helper.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/axes_helper.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/before_after.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/dat_gui.jpg"><meta property="og:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/stats.jpg"><meta property="og:updated_time" content="2020-04-28T03:04:50.303Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="十分钟打造 3D 物理世界"><meta name="twitter:description" content="前言在繁忙的业务中，为了缩短设计和开发的周期，我们的 H5 小游戏更多的会采用 2D 的视觉风格，但总是一个风格是很无趣的，所以最近搞了一个 3D 物理游戏的需求，在开发的过程中遇到了不少问题，希望通过这篇文章将关于 Three.js、Cannon.js、模型、工具等基础知识、问题总结分享给大家。 开始 3D 项目之前，首先从选择 3D 框架开始，老牌引擎 Three.js 和微软的 Babyl"><meta name="twitter:image" content="https://misc.aotu.io/ONE-SUNDAY/cannonjs/threejs_babylonjs.jpg"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script><script>window.WechatShareData={imgUrl:"//misc.aotu.io/ONE-SUNDAY/cannonjs/cover_200x200.jpg",link:window.location.href,title:"十分钟打造 3D 物理世界",desc:"Three.js 和 Cannon.js 的介绍与使用以及 glTF 模型格式、开发工具推荐等内容"},window.WechatJSSDKURL="https://aotu.jd.com/aotu-wx-api/api/wx/jssdk/signature"</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/cover_900x500.jpg" alt="十分钟打造 3D 物理世界"></div><header class="post-hd"><h1 class="post-tit">十分钟打造 3D 物理世界</h1><div class="post-meta">by <a target="_blank" href="https://github.com/o2-team" class="post-author">TH</a> on <span>2018-10-18</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>Three.js 和 Cannon.js 的介绍与使用以及 glTF 模型格式、开发工具推荐等内容</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><a id="more"></a><h2 id="前言" class="post-heading"><a href="#前言" class="headerlink" title="前言"></a>前言<a class="post-anchor" href="#前言" aria-hidden="true"></a></h2><p>在繁忙的业务中，为了缩短设计和开发的周期，我们的 H5 小游戏更多的会采用 2D 的视觉风格，但总是一个风格是很无趣的，所以最近搞了一个 3D 物理游戏的需求，在开发的过程中遇到了不少问题，希望通过这篇文章将关于 Three.js、Cannon.js、模型、工具等基础知识、问题总结分享给大家。</p><p>开始 3D 项目之前，首先从选择 3D 框架开始，老牌引擎 Three.js 和微软的 Babylon.js 都不错，针对自己的项目需求选择一款即可，这次我主要针对更熟悉的 Three.js 来讲。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/threejs_babylonjs.jpg" alt="three.js and babylon.js"></p><h2 id="Three-js-基础概念" class="post-heading"><a href="#Three-js-基础概念" class="headerlink" title="Three.js 基础概念"></a>Three.js 基础概念<a class="post-anchor" href="#Three-js-基础概念" aria-hidden="true"></a></h2><p>使用 Three.js 前，首先要理解以下几个核心概念：</p><h4 id="Sence-场景" class="post-heading"><a href="#Sence-场景" class="headerlink" title="Sence 场景"></a>Sence 场景<a class="post-anchor" href="#Sence-场景" aria-hidden="true"></a></h4><p>在 Three.js 中首先需要创建一个三维空间，我们称之为场景。</p><p>场景可以想象成是一个容器，里面存放着所有渲染的物体和使用的光源。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> scene = <span class="keyword">new</span> THREE.Scene()</span><br></pre></td></tr></table></figure><h4 id="Axes-坐标轴" class="post-heading"><a href="#Axes-坐标轴" class="headerlink" title="Axes 坐标轴"></a>Axes 坐标轴<a class="post-anchor" href="#Axes-坐标轴" aria-hidden="true"></a></h4><p>Three.js 采用的是右手坐标系，拇指、食指、中指分别表示 X、Y、Z 轴的方向。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/axes.jpg" alt="axes"></p><h4 id="Camera-摄像机" class="post-heading"><a href="#Camera-摄像机" class="headerlink" title="Camera 摄像机"></a>Camera 摄像机<a class="post-anchor" href="#Camera-摄像机" aria-hidden="true"></a></h4><p>摄像机就相当于我们的双眼，决定了能够在场景中的所见所得。</p><p>Three.js 中提供以下几种摄像机类型，最为常用的是 <strong>PerspectiveCamera 透视摄像机</strong>，其他了解下即可。</p><ul><li>ArrayCamera 阵列摄像机<ul><li>一个 ArrayCamera 会包含多个子摄像机，通过这一组子摄像机渲染出实际效果，适用于 VR 场景。</li></ul></li><li>CubeCamera 立方摄像机<ul><li>创建六个 PerspectiveCamera（透视摄像机），适用于镜面场景。</li></ul></li><li>StereoCamera 立体相机<ul><li>双透视摄像机适用于 3D 影片、视差效果。</li></ul></li></ul><h5 id="OrthographicCamera-正交摄像机" class="post-heading"><a href="#OrthographicCamera-正交摄像机" class="headerlink" title="OrthographicCamera 正交摄像机"></a>OrthographicCamera 正交摄像机<a class="post-anchor" href="#OrthographicCamera-正交摄像机" aria-hidden="true"></a></h5><p>OrthographicCamera（正交摄像机）定义了一个矩形可视区域，物体只有在这个区域内才是可见的，另外物体无论距离摄像机是远或事近，物体都会被渲染成一个大小，所以这种摄像机类型适用于 2.5D 场景（例如斜 45 度游戏）。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/OrthographicCamera.jpg?t=2" alt="OrthographicCamera"></p><h5 id="PerspectiveCamera-透视摄像机" class="post-heading"><a href="#PerspectiveCamera-透视摄像机" class="headerlink" title="PerspectiveCamera 透视摄像机"></a>PerspectiveCamera 透视摄像机<a class="post-anchor" href="#PerspectiveCamera-透视摄像机" aria-hidden="true"></a></h5><p>最为常用的摄像机类型，模拟人眼的视觉，根据物体距离摄像机的距离，近大远小。默认情况下，摄像机的初始位置 X、Y、Z 都为 0，摄像机方向是从正 Z 轴向负 Z 轴看去。通过 <code>Near</code> 和 <code>Far</code> 定义最近和最远的可视距离，<code>Fov</code> 定义可视的角度。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/PerspectiveCamera.jpg?t=2" alt="PerspectiveCamera"></p><h4 id="Mesh-网格" class="post-heading"><a href="#Mesh-网格" class="headerlink" title="Mesh 网格"></a>Mesh 网格<a class="post-anchor" href="#Mesh-网格" aria-hidden="true"></a></h4><p>有了场景和摄像头就可以看到 3D 场景中的物体，场景中的我们最为常用的物体称为网格。</p><p>网格由两部分组成：几何体和材质</p><h5 id="Geometry-几何体" class="post-heading"><a href="#Geometry-几何体" class="headerlink" title="Geometry 几何体"></a>Geometry 几何体<a class="post-anchor" href="#Geometry-几何体" aria-hidden="true"></a></h5><p>记录了渲染一个 3D 物体所需要的基本数据：Face 面、Vertex 顶点等信息。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/mesh.jpg" alt="geometry"></p><p>例如下面这个网格是由三角形组成，组成三角形的点称为顶点，组成的三角形称为面。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/vertex_face.jpg" alt="vertex_face"></p><h5 id="Material-材质" class="post-heading"><a href="#Material-材质" class="headerlink" title="Material 材质"></a>Material 材质<a class="post-anchor" href="#Material-材质" aria-hidden="true"></a></h5><p>材质就像是物体的皮肤，决定了几何体的外表。<br>外表的定义可以让一个物体看起来是否有镜面金属感、暗淡、纯色、或是透明与否等效果。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/material.jpg" alt="material"></p><h3 id="Light-光源" class="post-heading"><a href="#Light-光源" class="headerlink" title="Light 光源"></a>Light 光源<a class="post-anchor" href="#Light-光源" aria-hidden="true"></a></h3><p>光源相当于在密闭空间里的一盏灯，对于场景是必不可少的</p><p>在 Three.js 常用的有这几种光源：</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/light.jpg" alt="light"></p><h5 id="AmbientLight-环境光源" class="post-heading"><a href="#AmbientLight-环境光源" class="headerlink" title="AmbientLight 环境光源"></a>AmbientLight 环境光源<a class="post-anchor" href="#AmbientLight-环境光源" aria-hidden="true"></a></h5><p>属于基础光源，为场景中的所有物体提供一个基础亮度。</p><h5 id="DirectionalLight-平行光源" class="post-heading"><a href="#DirectionalLight-平行光源" class="headerlink" title="DirectionalLight 平行光源"></a>DirectionalLight 平行光源<a class="post-anchor" href="#DirectionalLight-平行光源" aria-hidden="true"></a></h5><p>效果类似太阳光，发出的光源都是平行的。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/DirectionalLight.jpg" alt="DirectionalLight"></p><h5 id="HemisphereLight-半球光源" class="post-heading"><a href="#HemisphereLight-半球光源" class="headerlink" title="HemisphereLight 半球光源"></a>HemisphereLight 半球光源<a class="post-anchor" href="#HemisphereLight-半球光源" aria-hidden="true"></a></h5><p>只有圆球的半边会发出光源。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/HemisphereLight.jpg" alt="HemisphereLight"></p><h5 id="PointLight-点光源" class="post-heading"><a href="#PointLight-点光源" class="headerlink" title="PointLight 点光源"></a>PointLight 点光源<a class="post-anchor" href="#PointLight-点光源" aria-hidden="true"></a></h5><p>一个点向四周发出光源，一般用于灯泡。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/PointLight.jpg" alt="PointLight"></p><h5 id="SpotLight-聚光灯光源" class="post-heading"><a href="#SpotLight-聚光灯光源" class="headerlink" title="SpotLight 聚光灯光源"></a>SpotLight 聚光灯光源<a class="post-anchor" href="#SpotLight-聚光灯光源" aria-hidden="true"></a></h5><p>一个圆锥体的灯光。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/SpotLight.jpg" alt="SpotLight"></p><h3 id="Shadow-阴影" class="post-heading"><a href="#Shadow-阴影" class="headerlink" title="Shadow 阴影"></a>Shadow 阴影<a class="post-anchor" href="#Shadow-阴影" aria-hidden="true"></a></h3><p>另外要注意并不是每一种光源都能产生阴影，目前只有三种光源可以：</p><ul><li>DirectionalLight 平行光源</li><li>PointLight 点光源</li><li>SpotLight 聚光灯光源</li></ul><p>另外如果要开启模型的阴影的话，模型是由多个 Mesh 组成的，只开启父的 Mesh 的阴影是不行的，还需要遍历父 Mesh 下所有的子 Mesh 为其开启投射阴影 <code>castShadow</code> 和接收投射阴影 <code>receiveShadow</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历子 Mesh 开启阴影</span></span><br><span class="line">object.traverse(<span class="function"><span class="keyword">function</span>(<span class="params">child</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (child <span class="keyword">instanceof</span> THREE.Mesh) &#123;</span><br><span class="line">    child.castShadow = <span class="literal">true</span></span><br><span class="line">    child.receiveShadow = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="glTF-模型格式" class="post-heading"><a href="#glTF-模型格式" class="headerlink" title="glTF 模型格式"></a>glTF 模型格式<a class="post-anchor" href="#glTF-模型格式" aria-hidden="true"></a></h2><p>前面提到 Three.js 引擎支持的格式非常的多，我们最为常见的格式有 <code>.obj</code> + <code>.mtl</code> + <code>.jpg/.png</code>，但使用这种模型格式存在一个问题，<code>.obj</code> 是静态模型，不支持动画数据存储，无法使用模型的动画，所以我建议使用 glTF 这种模型格式。</p><h5 id="glTF-模型格式介绍" class="post-heading"><a href="#glTF-模型格式介绍" class="headerlink" title="glTF 模型格式介绍"></a>glTF 模型格式介绍<a class="post-anchor" href="#glTF-模型格式介绍" aria-hidden="true"></a></h5><p>传统的 3D 模型格式的设计理念更多是针对本地离线使用，所以这类 3D 模型格式没有针对下载速度或加载速度进行优化，文件大小往往会非常的大，随着 Web 端的兴起，对文件大小更为敏感的今天，我们该尝试别的模型格式了。</p><p>glTF 是由 Khronos Group 开发的 3D 模型文件格式，该格式的特点是最大程度的减少了 3D 模型文件的大小，提高了传输、加载以及解析 3D 模型文件的效率，并且它可扩展，可互操作。</p><p>第一版 glTF 1.0 于 2015 年 10 月 19 日发布，2017 年 6 月 5 日的 Web 3D 2017 大会发布了最终版本 glTF 2.0。</p><h5 id="glTF-模型格式文件组成" class="post-heading"><a href="#glTF-模型格式文件组成" class="headerlink" title="glTF 模型格式文件组成"></a>glTF 模型格式文件组成<a class="post-anchor" href="#glTF-模型格式文件组成" aria-hidden="true"></a></h5><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/gltf_assets.jpg" alt="gltf_assets"></p><h6 id="模型文件-gltf" class="post-heading"><a href="#模型文件-gltf" class="headerlink" title="模型文件 .gltf"></a>模型文件 <code>.gltf</code><a class="post-anchor" href="#模型文件-gltf" aria-hidden="true"></a></h6><p>包含场景中节点层次结构、摄像机、网格、材质以及动画等描述信息。</p><h6 id="二进制文件-bin" class="post-heading"><a href="#二进制文件-bin" class="headerlink" title="二进制文件 .bin"></a>二进制文件 <code>.bin</code><a class="post-anchor" href="#二进制文件-bin" aria-hidden="true"></a></h6><p>包含几何、动画的数据以及其他基于缓冲区的数据，<code>.bin</code> 文件可以直接加载到 GPU 的缓冲区中从而不需要额外的解析，因此能够高效传输和快速加载。</p><h6 id="材质贴图文件-png-jpg" class="post-heading"><a href="#材质贴图文件-png-jpg" class="headerlink" title="材质贴图文件 .png/.jpg"></a>材质贴图文件 <code>.png/.jpg</code><a class="post-anchor" href="#材质贴图文件-png-jpg" aria-hidden="true"></a></h6><p>3D 模型做凹凸贴图或普通贴图上所使用到文件。</p><h5 id="glTF-模型格式导出" class="post-heading"><a href="#glTF-模型格式导出" class="headerlink" title="glTF 模型格式导出"></a>glTF 模型格式导出<a class="post-anchor" href="#glTF-模型格式导出" aria-hidden="true"></a></h5><p>官方在 <code>.gltf</code> 格式导出上提供了多种建模软件的导出插件，比如有：</p><ul><li>3DS Max Exporter</li><li>Maya Exporter</li><li>Blender glTF 2.0 Exporter</li><li>…</li></ul><p>正巧我们常用的 C4D 建模软件官方没有提供 C4D 的导出插件，所以我们使用 C4D 导出后再导入 Blender，通过 Blender 作为中转站导出 glTF 格式文件。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/exporter.jpg" alt="exporter"></p><p>但由于两个建模软件之间的材质并不能相通，导出后的模型文件材质效果表现不佳，这是因为 Blender 有自己的一套材质流程系统，例如有 <code>glTF Metallic Roughness</code> 和 <code>glTF Specular Glossiness</code>，需在此基础之上重新贴材质后导出解决。</p><p>另外注意的一点 Blender 的坐标系与 Three.js 是不同的，Blender 会将 Z 和 Y 对调位置，在导出时要选择 <code>Convert Z up to Y up</code> 进行对调。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/convert.jpg" alt="convert"></p><h5 id="Three-js-使用-glTF-模型" class="post-heading"><a href="#Three-js-使用-glTF-模型" class="headerlink" title="Three.js 使用 glTF 模型"></a>Three.js 使用 glTF 模型<a class="post-anchor" href="#Three-js-使用-glTF-模型" aria-hidden="true"></a></h5><p>Three.js 中使用 glTF 格式需额外引入 <a href="https://github.com/mrdoob/three.js/blob/master/examples/js/loaders/GLTFLoader.js" target="_blank" rel="noopener">GLTFLoader.js</a> 加载器。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gltfLoader = <span class="keyword">new</span> THREE.gltfLoader()</span><br><span class="line"></span><br><span class="line">gltfLoader.load(<span class="string">'./assets/box.gltf'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">sence</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> object = scene.gltf <span class="comment">// 模型对象</span></span><br><span class="line">  scene.add(object) <span class="comment">// 将模型添加到场景中</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="glTF-模型动画" class="post-heading"><a href="#glTF-模型动画" class="headerlink" title="glTF 模型动画"></a>glTF 模型动画<a class="post-anchor" href="#glTF-模型动画" aria-hidden="true"></a></h3><h5 id="Animation-Clip-动画片段" class="post-heading"><a href="#Animation-Clip-动画片段" class="headerlink" title="Animation Clip 动画片段"></a>Animation Clip 动画片段<a class="post-anchor" href="#Animation-Clip-动画片段" aria-hidden="true"></a></h5><p>前面提到 glTF 模型格式支持动画，模型动画可以使用 Blender 建模软件制作，通过 Blender 提供的时间轴编辑变形动画或者骨骼动画，每个动画可以编辑为一个 Action 动作，导出后使用 GLTFLoader 加载到 Three.js 中，可以拿到一个 <code>animations</code> 数组，<code>animations</code> 里包含了模型的每个动画 Action 动作。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/animation_clip.jpg" alt="animation_clip"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> gltfLoader = <span class="keyword">new</span> THREE.gltfLoader()</span><br><span class="line"><span class="keyword">let</span> mixer = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">gltfLoader.load(<span class="string">'./assets/box.gltf'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">sence</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> object = scene.gltf</span><br><span class="line">  <span class="keyword">let</span> animations = sence.animations <span class="comment">// 动画数据</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (animations &amp;&amp; animations.length) &#123;</span><br><span class="line">    mixer = <span class="keyword">new</span> THREE.AnimationMixer(object) <span class="comment">// 对动画进行控制</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; animations.length; i++) &#123;</span><br><span class="line">      mixer.clipAction(animations[i]).play() <span class="comment">// 播放所有动画</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  scene.add(object)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> delta = clock.getDelta(mixer)</span><br><span class="line">  mixer.update(delta) <span class="comment">// 更新动画片段</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Tween-动画" class="post-heading"><a href="#Tween-动画" class="headerlink" title="Tween 动画"></a>Tween 动画<a class="post-anchor" href="#Tween-动画" aria-hidden="true"></a></h5><p>对模型实现淡入淡出、缩放、位移、旋转等动画推荐使用 <a href="https://greensock.com/gsap?product=gsap" target="_blank" rel="noopener">GSAP</a> 来实现更为简便。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tween = <span class="keyword">new</span> TimelineMax()</span><br><span class="line"></span><br><span class="line">tween</span><br><span class="line">  .to(box.scale, <span class="number">1</span>, &#123; <span class="comment">// 从 1 缩放至 2，花费 1 秒</span></span><br><span class="line">    x: <span class="number">2</span>,</span><br><span class="line">    y: <span class="number">2</span>,</span><br><span class="line">    z: <span class="number">2</span>,</span><br><span class="line">    ease: Power0.easeInOut, <span class="comment">// 速度曲线</span></span><br><span class="line">    onStart: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 监听动画开始</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onUpdate: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 监听动画过程</span></span><br><span class="line">    &#125;,</span><br><span class="line">    onComplete: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 监听动画结束</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .to(box.position, <span class="number">1</span>, &#123; <span class="comment">// 缩放结束后，位移 x 至 10，花费 1 秒</span></span><br><span class="line">    x: <span class="number">10</span>,</span><br><span class="line">    y: <span class="number">0</span>,</span><br><span class="line">    z: <span class="number">0</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h3 id="Draco-3D-模型压缩工具" class="post-heading"><a href="#Draco-3D-模型压缩工具" class="headerlink" title="Draco 3D 模型压缩工具"></a>Draco 3D 模型压缩工具<a class="post-anchor" href="#Draco-3D-模型压缩工具" aria-hidden="true"></a></h3><p><a href="https://codelabs.developers.google.com/codelabs/draco-3d/index.html#0" target="_blank" rel="noopener">Draco</a> 是一个用于压缩、解压缩 3D 几何网格和<a href="https://zh.wikipedia.org/wiki/%E9%BB%9E%E9%9B%B2" target="_blank" rel="noopener">点云</a>的开源库，为改善 3D 图形存储和传输而设计。</p><p>使用该工具可以对 glTF 格式进一步的压缩，会将 glTF 格式转为 <code>.glb</code> 格式，并且 <code>.bin</code> 压缩效果拔群，但是在 Three.js 中使用 <code>.glb</code> 格式需要引入额外的解析库，解析库文件包括 <code>draco_decoder.js</code>（791KB）、<code>draco_decoder.wasm</code>（323 KB）、<code>draco_wasm_wrapper.js</code>（64.3 KB）。所以更推荐当模型文件数量多，且文件较大时使用，否则得不偿失。</p><p>压缩使用 <a href="https://github.com/AnalyticalGraphicsInc/gltf-pipeline" target="_blank" rel="noopener">glTF Pipeline</a> 工具，需要将三个种类的文件放在一起，执行命令行进行转换。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g gltf-pipeline <span class="comment">// 安装 gltf-pipeline 工具</span></span><br><span class="line">$ gltf-pipeline -i model.gltf -o model.glb <span class="comment">// 指定某个 .gltf 文件转为 .glb 格式</span></span><br></pre></td></tr></table></figure><p>Three.js 使用 <code>.glb</code> 格式引入 Draco 解码库</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化 loader</span></span><br><span class="line"><span class="keyword">let</span> loader = <span class="keyword">new</span> THREE.GLTFLoader()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draco 解码库</span></span><br><span class="line">THREE.DRACOLoader.setDecoderPath(<span class="string">'/examples/js/libs/draco'</span>)</span><br><span class="line">loader.setDRACOLoader(<span class="keyword">new</span> THREE.DRACOLoader())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载 glTF 模型</span></span><br><span class="line">loader.load(<span class="string">'models/gltf/box.gltf'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">gltf</span>) </span>&#123;</span><br><span class="line">  scene.add(gltf.scene)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="Cannon-js-3D-物理引擎" class="post-heading"><a href="#Cannon-js-3D-物理引擎" class="headerlink" title="Cannon.js 3D 物理引擎"></a>Cannon.js 3D 物理引擎<a class="post-anchor" href="#Cannon-js-3D-物理引擎" aria-hidden="true"></a></h2><p>目前在 Github 上搜索到的 3D 物理引擎库有 Cannon.js、Oimo.js、Ammo.js、Energy.js、Physijs 等等，大部分都已许久没有更新迭代了（长达好几年），项目的 Star 数量和 Issues 数量也不多，我们该如何选择？</p><p>Cannon.js、Oimo.js 和 Energy.js 作为 Babylon.js 的内置物理引擎，我们试着从这三个下手。</p><p><a href="https://github.com/samuelgirardin/Energy.js" target="_blank" rel="noopener">Energy.js</a>：使用 C++ 编写转 JavaScript 的 3D 物理引擎，源码不可读，目前 Github 比较冷清。</p><p><a href="https://github.com/lo-th/Oimo.js" target="_blank" rel="noopener">Oimo.js</a>：一款轻量级的 3D 物理引擎，文件大小 153 KB。</p><p><a href="https://github.com/schteppe/cannon.js" target="_blank" rel="noopener">Cannon.js</a>：完全使用 JavaScript 编写的优秀 3D 物理引擎，包含简单的碰撞检测、各种形状的摩擦力、弹力、约束等功能。</p><p>从综合性来看，我更偏向于 Cannon.js ，所以下面主要讲讲 Cannon.js。</p><h4 id="Cannon-js-的特性" class="post-heading"><a href="#Cannon-js-的特性" class="headerlink" title="Cannon.js 的特性"></a>Cannon.js 的特性<a class="post-anchor" href="#Cannon-js-的特性" aria-hidden="true"></a></h4><p>以下是 Cannon.js 的特性，基本可以满足大部分的 3D 物理开发场景。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/cannon.jpg" alt="cannon"></p><h4 id="使用-Cannon-js" class="post-heading"><a href="#使用-Cannon-js" class="headerlink" title="使用 Cannon.js"></a>使用 Cannon.js<a class="post-anchor" href="#使用-Cannon-js" aria-hidden="true"></a></h4><p>我们以官方的一个平面加球刚体的例子来快速上手 Cannon.js。<a href="http://jdc.jd.com/demo/th/cannonjs/index.html" target="_blank" rel="noopener">在线例子</a></p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/cannon_demo.jpg" alt="cannon_demo"></p><h6 id="1、初始化物理世界" class="post-heading"><a href="#1、初始化物理世界" class="headerlink" title="1、初始化物理世界"></a>1、初始化物理世界<a class="post-anchor" href="#1、初始化物理世界" aria-hidden="true"></a></h6><p>使用 Cannon.js 前需要创建 CANNON.World 对象，CANNON.World 对象是负责管理对象和模拟物理的中心。</p><p>创建完 CANNON.World 对象后，接着设置物理世界的重力，这里设置了负 Y 轴为 10 m/s²。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> world = <span class="keyword">new</span> CANNON.World()</span><br><span class="line">world.gravity.set(<span class="number">0</span>, <span class="number">-10</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>Cannon.js 提供了 Broadphase、NaiveBroadphase 两种碰撞检测阶段，默认是 NaiveBroadphase。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">world.broadphase = <span class="keyword">new</span> CANNON.NaiveBroadphase()</span><br></pre></td></tr></table></figure><h6 id="2、创建动态球体" class="post-heading"><a href="#2、创建动态球体" class="headerlink" title="2、创建动态球体"></a>2、创建动态球体<a class="post-anchor" href="#2、创建动态球体" aria-hidden="true"></a></h6><p>创建 Body 分三个步骤：</p><ul><li>创建形状</li><li>为形状添加刚体</li><li>将刚体添加到世界</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sphereShape = <span class="keyword">new</span> CANNON.Sphere(<span class="number">1</span>) <span class="comment">// Step 1 </span></span><br><span class="line"><span class="keyword">let</span> sphereBody = <span class="keyword">new</span> CANNON.Body(&#123; <span class="comment">// Step 2</span></span><br><span class="line">  mass: <span class="number">5</span>,</span><br><span class="line">  position: <span class="keyword">new</span> CANNON.Vec3(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>),</span><br><span class="line">  shape: sphereShape</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">world.add(sphereBody) <span class="comment">// Step 3</span></span><br></pre></td></tr></table></figure><p>第一步创建了半径为 1 的球形，第二步创建球的刚体，如果刚体的 mass 属性设置为 0，刚体则会处于静止状态，静止的物体不会和其他静止的物体发生碰撞，我们这里为球的刚体设置了 5kg，球会处于动态的状态，会受的重力的影响而移动，会与其他物体发生碰撞。</p><h6 id="3、创建静态平面和动态球体" class="post-heading"><a href="#3、创建静态平面和动态球体" class="headerlink" title="3、创建静态平面和动态球体"></a>3、创建静态平面和动态球体<a class="post-anchor" href="#3、创建静态平面和动态球体" aria-hidden="true"></a></h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 平面 Body</span></span><br><span class="line"><span class="keyword">let</span> groundShape = <span class="keyword">new</span> CANNON.Plane()</span><br><span class="line"><span class="keyword">let</span> groundBody = <span class="keyword">new</span> CANNON.Body(&#123;</span><br><span class="line">  mass: <span class="number">0</span>,</span><br><span class="line">  shape: groundShape</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// setFromAxisAngle 旋转 X 轴 -90 度</span></span><br><span class="line">groundBody.quaternion.setFromAxisAngle(<span class="keyword">new</span> CANNON.Vec3(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">-1.5707963267948966</span>)</span><br><span class="line"></span><br><span class="line">world.add(groundBody)</span><br></pre></td></tr></table></figure><p>创建平面形状，接着是刚体，这里设置了平面刚体的 mass 为 0，保证刚体处于静止状态。默认情况下平面的方向是朝向 Z 方向的（竖立着），可以通过 <code>Body.quaternion.setFromAxisAngle</code> 对平面进行旋转。</p><h6 id="4、创建平面和球的网格" class="post-heading"><a href="#4、创建平面和球的网格" class="headerlink" title="4、创建平面和球的网格"></a>4、创建平面和球的网格<a class="post-anchor" href="#4、创建平面和球的网格" aria-hidden="true"></a></h6><p>前面创建的刚体在场景中并没有实际的视觉效果，这一步创建平面、球的网格。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 平面网格</span></span><br><span class="line"><span class="keyword">let</span> groundGeometry = <span class="keyword">new</span> THREE.PlaneGeometry(<span class="number">20</span>, <span class="number">20</span>, <span class="number">32</span>)</span><br><span class="line"><span class="keyword">let</span> groundMaterial = <span class="keyword">new</span> THREE.MeshStandardMaterial(&#123;</span><br><span class="line">  color: <span class="number">0x7f7f7f</span>,</span><br><span class="line">  side: THREE.DoubleSide</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> ground = <span class="keyword">new</span> THREE.Mesh(groundGeometry, groundMaterial)</span><br><span class="line">scene.add(ground)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 球网格</span></span><br><span class="line"><span class="keyword">let</span> sphereGeometry = <span class="keyword">new</span> THREE.SphereGeometry(<span class="number">1</span>, <span class="number">32</span>, <span class="number">32</span>)</span><br><span class="line"><span class="keyword">let</span> sphereMaterial = <span class="keyword">new</span> THREE.MeshStandardMaterial(&#123; <span class="attr">color</span>: <span class="number">0xffff00</span> &#125;)</span><br><span class="line"><span class="keyword">let</span> sphere = <span class="keyword">new</span> THREE.Mesh(sphereGeometry, sphereMaterial)</span><br><span class="line">scene.add(sphere)</span><br></pre></td></tr></table></figure><h6 id="5、模拟世界" class="post-heading"><a href="#5、模拟世界" class="headerlink" title="5、模拟世界"></a>5、模拟世界<a class="post-anchor" href="#5、模拟世界" aria-hidden="true"></a></h6><p>接着我们为物理世界开启持续更新，并且将创建的球刚体与球网格关联起来。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  requestAnimationFrame(update)</span><br><span class="line">  world.step(<span class="number">1</span> / <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sphere) &#123;</span><br><span class="line">    sphere.position.copy(sphereBody.position)</span><br><span class="line">    sphere.quaternion.copy(sphereBody.quaternion)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过这几步，一个简单的物理场景就完成了，另外更多官方例子可以<a href="http://schteppe.github.io/cannon.js/" target="_blank" rel="noopener">点击这里</a>，可以查看到 Cannon.js 各个约束、摩擦力、模拟汽车等特性的例子。</p><h4 id="其他：" class="post-heading"><a href="#其他：" class="headerlink" title="其他："></a>其他：<a class="post-anchor" href="#其他：" aria-hidden="true"></a></h4><h6 id="1、自定义物理材质需关联" class="post-heading"><a href="#1、自定义物理材质需关联" class="headerlink" title="1、自定义物理材质需关联"></a>1、自定义物理材质需关联<a class="post-anchor" href="#1、自定义物理材质需关联" aria-hidden="true"></a></h6><p>还是上面的例子，现在场景中刚体的物理特性都为默认的，我希望球的恢复系数高一点，即掉落时弹跳的更高。首先需要通过 <code>CANNON.Material</code> 实例物理材质，刚体使用该物理材质，最后通过 <code>CANNON.ContactMaterial</code> 来定义两个刚体相遇后会发生什么。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 平面</span></span><br><span class="line"><span class="keyword">let</span> ground_cm = <span class="keyword">new</span> CANNON.Material() <span class="comment">// Step 1 : 实例 CANNON.Material</span></span><br><span class="line"><span class="keyword">let</span> groundBody = <span class="keyword">new</span> CANNON.Body(&#123;</span><br><span class="line">    ...</span><br><span class="line">    material: groundMaterial <span class="comment">// Step 2 : 使用该物理材质</span></span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 球</span></span><br><span class="line"><span class="keyword">let</span> sphere_cm = <span class="keyword">new</span> CANNON.Material()</span><br><span class="line"><span class="keyword">let</span> sphereBody = <span class="keyword">new</span> CANNON.Body(&#123;</span><br><span class="line">    ...</span><br><span class="line">    material: sphere_cm</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sphere_ground = <span class="keyword">new</span> CANNON.ContactMaterial(ground_cm, sphere_cm, &#123; <span class="comment">// Step 3 : 定义两个刚体相遇后会发生什么</span></span><br><span class="line">    friction: <span class="number">1</span>,</span><br><span class="line">    restitution: <span class="number">0.4</span></span><br><span class="line">&#125;)</span><br><span class="line">world.addContactMaterial(sphere_ground) <span class="comment">// Step 4 : 添加到世界中</span></span><br></pre></td></tr></table></figure><h6 id="2、刚体添加位移动画时需取消速度值" class="post-heading"><a href="#2、刚体添加位移动画时需取消速度值" class="headerlink" title="2、刚体添加位移动画时需取消速度值"></a>2、刚体添加位移动画时需取消速度值<a class="post-anchor" href="#2、刚体添加位移动画时需取消速度值" aria-hidden="true"></a></h6><p>比如我使用 GSAP 库对某个刚体进行 Y 轴向上移动，在 update 阶段需要将刚体的重力加速度设置为 0，否则动画结束后刚体会出现向下砸的效果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tween = <span class="keyword">new</span> TimelineMax()</span><br><span class="line">tween.to(boxBody.position, <span class="number">2</span>, &#123;</span><br><span class="line">  x: <span class="number">0</span>,</span><br><span class="line">  y: <span class="number">10</span>,</span><br><span class="line">  z: <span class="number">0</span>,</span><br><span class="line">  update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 归 0 设置</span></span><br><span class="line">    boxBody.velocity.setZero()</span><br><span class="line">    boxBody.initVelocity.setZero()</span><br><span class="line">    boxBody.angularVelocity.setZero()</span><br><span class="line">    boxBody.initAngularVelocity.setZero()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="3、只检测碰撞，不发生物理效果" class="post-heading"><a href="#3、只检测碰撞，不发生物理效果" class="headerlink" title="3、只检测碰撞，不发生物理效果"></a>3、只检测碰撞，不发生物理效果<a class="post-anchor" href="#3、只检测碰撞，不发生物理效果" aria-hidden="true"></a></h6><p>允许只检测是否碰撞，实际不发生物理效果，需要为刚体添加以下属性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boxBody.collisionResponse = <span class="literal">false</span></span><br></pre></td></tr></table></figure><h6 id="4、缩放刚体" class="post-heading"><a href="#4、缩放刚体" class="headerlink" title="4、缩放刚体"></a>4、缩放刚体<a class="post-anchor" href="#4、缩放刚体" aria-hidden="true"></a></h6><p>如果刚体需要缩放，则需要为刚体添加此属性，来更新刚体大小。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">boxBody.updateMassProperties()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tween = <span class="keyword">new</span> TimelineMax()</span><br><span class="line">tween.to(sphereBody.shapes[<span class="number">0</span>], <span class="number">2</span>, &#123;</span><br><span class="line">  radius: <span class="number">0.2</span> <span class="comment">// 缩放至 0.2</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="点击交互" class="post-heading"><a href="#点击交互" class="headerlink" title="点击交互"></a>点击交互<a class="post-anchor" href="#点击交互" aria-hidden="true"></a></h2><p>在 3D 的世界中不能像我们在 DOM 中为一个节点绑定点击事件那么容易，在 Three.js 中提供了 <code>THREE.Raycaster</code> 方法处理点击交互，使用鼠标或者手指点击屏幕时，会将二维坐标进行转换，发射一条射线判断与哪个物体发生了碰撞，由此得知点击了哪个物体。<a href="https://threejs.org/examples/?q=ray#webgl_raycast_sprite" target="_blank" rel="noopener">点击这里官方例子</a></p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/ray.jpg" alt="raycaster"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> raycaster = <span class="keyword">new</span> THREE.Raycaster()</span><br><span class="line"><span class="keyword">let</span> mouse = <span class="keyword">new</span> THREE.Vector2()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onTouchEnd</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 点击获取屏幕坐标</span></span><br><span class="line">  <span class="keyword">var</span> event = ev.changedTouches[<span class="number">0</span>]</span><br><span class="line">  mouse.x = (event.clientX / <span class="built_in">window</span>.innerWidth) * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">  mouse.y = -(event.clientY / <span class="built_in">window</span>.innerHeight) * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  raycaster.setFromCamera(mouse, camera)</span><br><span class="line">  <span class="keyword">let</span> intersects = raycaster.intersectObjects(scene, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; intersects.length; i++) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(intersects[i]) <span class="comment">// 与射线发生碰撞的物体</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="性能方面" class="post-heading"><a href="#性能方面" class="headerlink" title="性能方面"></a>性能方面<a class="post-anchor" href="#性能方面" aria-hidden="true"></a></h2><h5 id="模型精细程度" class="post-heading"><a href="#模型精细程度" class="headerlink" title="模型精细程度"></a>模型精细程度<a class="post-anchor" href="#模型精细程度" aria-hidden="true"></a></h5><p>在 Web 端由于性能的限制，在开发过程中要尽量避免做一些损耗性能较大的事情。</p><p>首先是模型的精细程度，在保证效果的前提下，尽量降低模型面的数量，也就是说采用低模模型，一些模型的凹凸褶皱感也可以通过凹凸贴图的方式去实现，越是复杂的模型在实时渲染的过程中就越占用手机性能。</p><h5 id="光源与阴影" class="post-heading"><a href="#光源与阴影" class="headerlink" title="光源与阴影"></a>光源与阴影<a class="post-anchor" href="#光源与阴影" aria-hidden="true"></a></h5><p>另外一方面光源、阴影也是占性能，尤其是阴影。光源一般会使用平行光或者聚光灯，这种光源照射在物体上更为真实，使用半球光会稍微提升帧数，但效果略差些，阴影效果前面提到过要遍历每一个子 Mesh 接收产生阴影 <code>castShadow</code> 和接收阴影 <code>receiveShadow</code>，这相当耗费性能，开启后对阴影的精细程度以及阴影类型进行参数优化，在 Android 系统性能不太好，iOS 系统基本能保证流畅运行，所以建议根据设备系统优化。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = navigator.userAgent</span><br><span class="line"><span class="keyword">if</span> (<span class="regexp">/iPad|iPhone|iPod/</span>.test(n) &amp;&amp; !<span class="built_in">window</span>.MSStream) &#123; &#125; <span class="comment">// 针对 iOS 系统使用阴影</span></span><br></pre></td></tr></table></figure><h5 id="抗锯齿与像素比" class="post-heading"><a href="#抗锯齿与像素比" class="headerlink" title="抗锯齿与像素比"></a>抗锯齿与像素比<a class="post-anchor" href="#抗锯齿与像素比" aria-hidden="true"></a></h5><p>抗锯齿是让模型的边缘效果更加圆滑不粗糙，也会占用一些性能，默认是关闭的，视情况开启。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">renderer.antialias = <span class="literal">true</span> <span class="comment">// 开启抗锯齿</span></span><br></pre></td></tr></table></figure><p>另外像素比 <code>setPixelRatio</code>，移动端由于 Retina 屏的缘故，一般会设置为 2，所以使用 <code>window.devicePixelRatio</code> 获取实际设备像素比动态设置的话，部分大屏手机的像素比有 3 的情况，所有会因为像素比过高造成性能问题。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">renderer.setPixelRatio(<span class="number">2</span>) <span class="comment">// 推荐</span></span><br><span class="line">renderer.setPixelRatio(<span class="built_in">window</span>.devicePixelRatio) <span class="comment">// 不推荐</span></span><br></pre></td></tr></table></figure><h2 id="工具推荐" class="post-heading"><a href="#工具推荐" class="headerlink" title="工具推荐"></a>工具推荐<a class="post-anchor" href="#工具推荐" aria-hidden="true"></a></h2><p>最后推荐一些在开发过程中常用的工具：</p><h5 id="OrbitControls-轨道控制器" class="post-heading"><a href="#OrbitControls-轨道控制器" class="headerlink" title="OrbitControls 轨道控制器"></a>OrbitControls 轨道控制器<a class="post-anchor" href="#OrbitControls-轨道控制器" aria-hidden="true"></a></h5><p>OrbitControls 是用于调试 Camera 的方法，实例化后可以通过鼠标拖拽来旋转 Camera 镜头的角度，鼠标滚轮可以控制 Camera 镜头的远近距离，旋转和远近都会基于场景的中心点，在调试预览则会轻松许多。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> THREE.OrbitControls(camera, renderer.domElement)</span><br></pre></td></tr></table></figure><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/OrbitControls.jpg" alt="OrbitControls"></p><h5 id="glTF-Viewer-模型快速预览工具" class="post-heading"><a href="#glTF-Viewer-模型快速预览工具" class="headerlink" title="glTF Viewer 模型快速预览工具"></a>glTF Viewer 模型快速预览工具<a class="post-anchor" href="#glTF-Viewer-模型快速预览工具" aria-hidden="true"></a></h5><p>在设计师建模完成导出后，设计师并不知道在 Three.js 最终会呈现一个什么效果或者开发者也想快速的查看模型是否存在问题，glTF 官方贴心的提供了一款快速预览的工具，提供了两个版本：<a href="https://gltf-viewer.donmccurdy.com/" target="_blank" rel="noopener">Web 版本</a>和 <a href="https://github.com/donmccurdy/three-gltf-viewer/releases" target="_blank" rel="noopener">Desktop 版本</a>。</p><p>将 <code>.gltf</code>、<code>.bin</code>、<code>.jpg/.png</code> 文件拖拽到工具中，可以调试预览到模型的动画、变形目标、背景、线框模式、自动旋转、光源等功能。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/gltf_viewer.jpg" alt="gltf_viewer"></p><h5 id="Helper-相关调试模式" class="post-heading"><a href="#Helper-相关调试模式" class="headerlink" title="Helper 相关调试模式"></a>Helper 相关调试模式<a class="post-anchor" href="#Helper-相关调试模式" aria-hidden="true"></a></h5><h6 id="Camera-Helper-摄像机调试模式" class="post-heading"><a href="#Camera-Helper-摄像机调试模式" class="headerlink" title="Camera Helper 摄像机调试模式"></a>Camera Helper 摄像机调试模式<a class="post-anchor" href="#Camera-Helper-摄像机调试模式" aria-hidden="true"></a></h6><p>开启 Camera Helper 调试模式后，可以直观的看到 Camera 的 <code>Fov</code>、 <code>Nera</code>、<code>Far</code> 的参数效果。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/camera_helper.jpg" alt="camera_helper"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">45</span>, <span class="built_in">window</span>.innerWidth / <span class="built_in">window</span>.innerHeight, <span class="number">0.1</span>, <span class="number">1000</span>)</span><br><span class="line"><span class="keyword">let</span> helper = <span class="keyword">new</span> THREE.CameraHelper(camera)</span><br><span class="line"></span><br><span class="line">scene.add(helper)</span><br></pre></td></tr></table></figure><h6 id="Light-Helper-光源调试模式" class="post-heading"><a href="#Light-Helper-光源调试模式" class="headerlink" title="Light Helper 光源调试模式"></a>Light Helper 光源调试模式<a class="post-anchor" href="#Light-Helper-光源调试模式" aria-hidden="true"></a></h6><p>聚光灯开启 Light Helper 调试模式后，可以直观的看到 <code>distance</code>、<code>angle</code> 的参数效果。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> light = <span class="keyword">new</span> THREE.DirectionalLight(<span class="number">0xffffff</span>)</span><br><span class="line"><span class="keyword">let</span> helper = <span class="keyword">new</span> THREE.DirectionalLightHelper(<span class="number">0xffffff</span>)</span><br><span class="line"></span><br><span class="line">scene.add(helper)</span><br></pre></td></tr></table></figure><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/light_helper.jpg" alt="light_helper"></p><h6 id="AxesHelper-坐标轴调试模式" class="post-heading"><a href="#AxesHelper-坐标轴调试模式" class="headerlink" title="AxesHelper 坐标轴调试模式"></a>AxesHelper 坐标轴调试模式<a class="post-anchor" href="#AxesHelper-坐标轴调试模式" aria-hidden="true"></a></h6><p>AxesHelper 是在场景的中心点，添加一个坐标轴（红色：X 轴、绿色：Y 轴、蓝色：Z 轴），方便辨别方向。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/axes_helper.jpg" alt="axes_helper"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> axesHelper = <span class="keyword">new</span> THREE.AxesHelper(<span class="number">10</span>)</span><br><span class="line">scene.add(axesHelper)</span><br></pre></td></tr></table></figure><h5 id="Cannon-js-3D-物理引擎调试模式" class="post-heading"><a href="#Cannon-js-3D-物理引擎调试模式" class="headerlink" title="Cannon.js 3D 物理引擎调试模式"></a>Cannon.js 3D 物理引擎调试模式<a class="post-anchor" href="#Cannon-js-3D-物理引擎调试模式" aria-hidden="true"></a></h5><p>Cannon.js 3D 物理引擎提供的调试模式需引入 <a href="https://github.com/schteppe/cannon.js/tree/master/tools/threejs" target="_blank" rel="noopener">Debug renderer for Three.js</a>，可以将创建的物理盒子、球、平面等显示线框，便于在使用过程中实时查看效果。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/before_after.jpg" alt="before_after"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cannonDebugRenderer = <span class="keyword">new</span> THREE.CannonDebugRenderer(scene, world)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  requestAnimationFrame(render)</span><br><span class="line">  cannonDebugRenderer.update() <span class="comment">// Update the debug renderer</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="dat-GUI-图形用户界面调试工具" class="post-heading"><a href="#dat-GUI-图形用户界面调试工具" class="headerlink" title="dat.GUI 图形用户界面调试工具"></a>dat.GUI 图形用户界面调试工具<a class="post-anchor" href="#dat-GUI-图形用户界面调试工具" aria-hidden="true"></a></h5><p>在开发过程中，常常需要对参数变量进行微调，针对这个 Three.js 提供了 <a href="https://github.com/dataarts/dat.gui" target="_blank" rel="noopener">dat.GUI</a>，dat.GUI 是一个轻量级的图形用户界面调试工具，使用后在右上角会出现一个 GUI 可视化参数配置区域，通过修改数值来实时查看结果。</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/dat_gui.jpg" alt="dat_gui"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> opts = &#123;</span><br><span class="line">  x: <span class="number">0</span>,</span><br><span class="line">  y: <span class="number">0</span>,</span><br><span class="line">  scale: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gui = <span class="keyword">new</span> dat.GUI()</span><br><span class="line">gui.add(opts, <span class="string">'x'</span>, <span class="number">-3</span>, <span class="number">3</span>)</span><br><span class="line">gui.add(opts, <span class="string">'y'</span>, <span class="number">-3</span>, <span class="number">3</span>)</span><br><span class="line">gui.add(opts, <span class="string">'scale'</span>, <span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  cube.position.x = opt.x</span><br><span class="line">  cube.position.y = opt.y</span><br><span class="line">  cube.scale.set(opts.scale, opts.scale, opts.scale)</span><br><span class="line"></span><br><span class="line">  requestAnimationFrame()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Stats-调试工具" class="post-heading"><a href="#Stats-调试工具" class="headerlink" title="Stats 调试工具"></a>Stats 调试工具<a class="post-anchor" href="#Stats-调试工具" aria-hidden="true"></a></h5><p><a href="https://github.com/mrdoob/stats.js/" target="_blank" rel="noopener">Stats 工具</a>可以实时查看：</p><p>FPS：最后一秒的帧数，越大越流畅</p><p>MS：渲染一帧需要的时间（毫秒），越低越好</p><p>MB：占用的内存信息</p><p>CUSTOM：自定义面板</p><p><img src="//misc.aotu.io/ONE-SUNDAY/cannonjs/stats.jpg" alt="stats"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stats = <span class="keyword">new</span> Stats()</span><br><span class="line">stats.showPanel(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(stats.dom)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">animate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  requestAnimationFrame(animate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestAnimationFrame(animate)</span><br></pre></td></tr></table></figure><h2 id="尾巴" class="post-heading"><a href="#尾巴" class="headerlink" title="尾巴"></a>尾巴<a class="post-anchor" href="#尾巴" aria-hidden="true"></a></h2><p>最后，希望本篇文章所讲到的内容能帮助你更好的开发 3D 项目。另外，如果你有更好的实现思路，也欢迎你在下方评论区留言，感谢您的阅读。</p><h2 id="参考" class="post-heading"><a href="#参考" class="headerlink" title="参考"></a>参考<a class="post-anchor" href="#参考" aria-hidden="true"></a></h2><ul><li>《Learning Three.js》</li><li><a href="https://threejs.org/" target="_blank" rel="noopener">threejs</a></li><li><a href="https://www.babylonjs.com/" target="_blank" rel="noopener">babylonjs</a></li><li><a href="https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md" target="_blank" rel="noopener">glTF 2.0 README</a></li><li><a href="https://github.com/schteppe/cannon.js" target="_blank" rel="noopener">Cannon.js</a></li><li><a href="https://github.com/schteppe/cannon.js/tree/master/tools/threejs" target="_blank" rel="noopener">Debug renderer for Three.js</a></li><li><a href="https://github.com/donmccurdy/three-gltf-viewer" target="_blank" rel="noopener">three-gltf-viewer</a></li><li><a href="https://github.com/mrdoob/stats.js/#javascript-performance-monitor" target="_blank" rel="noopener">stats.js</a></li></ul><div class="post-tags" style="display:none"><a href="/tags/Three-js/">Three.js</a> <a href="/tags/Cannon-js/">Cannon.js</a> <a href="/tags/glTF/">glTF</a></div><div class="post-categories" style="display:none"><a href="/cates/H5游戏开发/">H5游戏开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2018/10/18/cannonjs/">https://aotu.io/notes/2018/10/18/cannonjs/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-04-28T03:04:50.303Z">上次更新：2020-04-28 11:04:50</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2018/10/22/Responsive-single-screen-design/" title="单屏页面响应式适配玩法">单屏页面响应式适配玩法 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2018/09/18/taro-1-0-0/" title="多端统一开发框架 Taro 1.0 正式发布"><i class="fa fa-chevron-left"></i> 多端统一开发框架 Taro 1.0 正式发布</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxOC8xMC8xOC9jYW5ub25qcy8=",owner:"o2team",repo:"o2team.github.io",title:"十分钟打造 3D 物理世界",body:"https://aotu.io/notes/2018/10/18/cannonjs/index.html\n\nThree.js 和 Cannon.js 的介绍与使用以及 glTF 模型格式、开发工具推荐等内容",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["o2-team"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>