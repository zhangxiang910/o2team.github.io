<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>PostCSS快速入门使用 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="Web开发,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2015/10/13/start-postcss/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：  PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a"><meta name="keywords" content="Web开发"><meta property="og:type" content="article"><meta property="og:title" content="PostCSS快速入门使用"><meta property="og:url" content="https://aotu.io/notes/2015/10/13/start-postcss/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：  PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://img30.360buyimg.com/ling/jfs/t1/83331/36/2048/81410/5d070378E8c5ab016/15bc1ce44aca1738.png"><meta property="og:updated_time" content="2020-04-28T03:04:50.287Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="PostCSS快速入门使用"><meta name="twitter:description" content="初识PostCSS如果你第一次听说PostCSS这个东西，那么请看下面摘自官方Github的介绍：  PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, a"><meta name="twitter:image" content="https://img30.360buyimg.com/ling/jfs/t1/83331/36/2048/81410/5d070378E8c5ab016/15bc1ce44aca1738.png"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="//img14.360buyimg.com/ling/jfs/t1/48017/11/2528/73775/5d07034dE7165a710/2f3b0fa0b5db7a9c.jpg" alt="PostCSS快速入门使用"></div><header class="post-hd"><h1 class="post-tit">PostCSS快速入门使用</h1><div class="post-meta">by <a target="_blank" href="https://github.com/cnt1992" class="post-author">Sky</a> on <span>2015-10-13</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>PostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><h2 id="初识PostCSS" class="post-heading"><a href="#初识PostCSS" class="headerlink" title="初识PostCSS"></a>初识PostCSS<a class="post-anchor" href="#初识PostCSS" aria-hidden="true"></a></h2><p>如果你第一次听说<code>PostCSS</code>这个东西，那么请看下面摘自官方<code>Github</code>的介绍：</p><blockquote><p>PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, and more</p></blockquote><p>翻译成中文的意思如下：</p><blockquote><p>PostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多</p></blockquote><p>我们用过<code>Less</code>、<code>SASS</code>等工具来对CSS做<code>预处理</code>操作，按照它们约定的语法来书写并且最终转换成可用的样式，这付出的代价是<strong>必须先熟悉这个工具的书写语法</strong>。</p><p>随着近几年 <a href="http://gruntjs.cn/" target="_blank" rel="noopener">Grunt</a>、<a href="http://gulpjs.com/" target="_blank" rel="noopener">Gulp</a>、<a href="http://webpack.github.io/docs/" target="_blank" rel="noopener">Webpack</a> 等自动化工具的兴起，<code>组合式应用</code>变得非常的热门，那<code>PostCSS</code>存在的意义是什么呢？答案是：<strong>CSS生态系统</strong></p><p><code>PostCSS</code>拥有非常多的插件，诸如自动为CSS添加浏览器前缀的插件<code>autoprefixer</code>、当前移动端最常用的<code>px</code>转<code>rem</code>插件<code>px2rem</code>，还有支持尚未成为CSS标准但特定可用的插件<code>cssnext</code>，还有很多很多。就连著名的<code>Bootstrap</code>在下一个版本<code>Bootstrap 5</code>也将使用<code>PostCSS</code>作为样式的基础。</p><p>一句话来概括PostCSS：<strong>CSS编译器能够做到的事情，它也可以做到，而且能够做得更好</strong></p><h2 id="快速使用PostCSS" class="post-heading"><a href="#快速使用PostCSS" class="headerlink" title="快速使用PostCSS"></a>快速使用PostCSS<a class="post-anchor" href="#快速使用PostCSS" aria-hidden="true"></a></h2><p>上面大致介绍了<code>PostCSS</code>，也许我们并没有在头脑里形成对它的认知，那下面我们就通过一个简单地实例来看看如何使用<code>PostCSS</code>。</p><p><code>PostCSS</code>得益于插件，支持Grunt,Gulp,webpack,Broccoli,Brunch还有ENB，这里我们将以<code>Gulp</code>作为实例来讲。</p><h3 id="环境准备" class="post-heading"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备<a class="post-anchor" href="#环境准备" aria-hidden="true"></a></h3><p>创建并进入我们的实例目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-demo &amp;&amp; <span class="built_in">cd</span> postcss-demo</span><br></pre></td></tr></table></figure><p>然后快速生成<code>package.json</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --yes 参数能够帮助我们快速生成默认的package.json</span></span><br><span class="line">npm init --yes</span><br></pre></td></tr></table></figure><p>将上面创建的<code>package.json</code>文件的<code>main</code>参数改为<code>gulpfile.js</code>，然后安装我们所需的依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gulp跟gulp-postcss是必须的，后面两个插件为了演示用途</span></span><br><span class="line">npm i gulp gulp-postcss autoprefixer autoprefixer-core cssnext --save-dev -d</span><br></pre></td></tr></table></figure><p>创建<code>gulpfile.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令行进行创建，你也可以手动新建</span></span><br><span class="line">touch gulpfile.js</span><br></pre></td></tr></table></figure><h3 id="修改gulpfile-js" class="post-heading"><a href="#修改gulpfile-js" class="headerlink" title="修改gulpfile.js"></a>修改gulpfile.js<a class="post-anchor" href="#修改gulpfile-js" aria-hidden="true"></a></h3><p>将下面代码贴进<code>gulpfile.js</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>);</span><br><span class="line"><span class="keyword">var</span> cssnext = <span class="built_in">require</span>(<span class="string">'cssnext'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义css任务</span></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//定义postcss任务流数组</span></span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">    autoprefixer(&#123;</span><br><span class="line">      browsers:[<span class="string">'last 3 version'</span>],</span><br><span class="line">      cascade: <span class="literal">false</span>,</span><br><span class="line">      remove: <span class="literal">false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    cssnext()</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="创建示例样式" class="post-heading"><a href="#创建示例样式" class="headerlink" title="创建示例样式"></a>创建示例样式<a class="post-anchor" href="#创建示例样式" aria-hidden="true"></a></h3><p>在项目根目录下创建src目录，再在src目录下面创建css目录，然后创建style.css文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令创建，你也可以手动创建</span></span><br><span class="line">mkdir -p src/css &amp;&amp; touch style.css</span><br></pre></td></tr></table></figure><p>编辑样式如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>:flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line"><span class="attribute">--fontSize</span>: <span class="number">1rem</span>;</span><br><span class="line"><span class="attribute">--mainColor</span>: <span class="number">#12345678</span>;</span><br><span class="line"><span class="attribute">--highlightColor</span>: <span class="built_in">hwb</span>(190, 35%, 20%);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">color</span>: <span class="built_in">var</span>(--mainColor);</span><br><span class="line"></span><br><span class="line"><span class="attribute">font-size</span>: <span class="built_in">var</span>(--fontSize);</span><br><span class="line"><span class="attribute">line-height</span>: <span class="built_in">calc</span>(var(--fontSize) * <span class="number">1.5</span>);</span><br><span class="line"><span class="attribute">padding</span>: <span class="built_in">calc</span>((var(--fontSize) / <span class="number">2</span>) + <span class="number">1px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="运行实例" class="post-heading"><a href="#运行实例" class="headerlink" title="运行实例"></a>运行实例<a class="post-anchor" href="#运行实例" aria-hidden="true"></a></h3><p>一切准备就绪之后可以在项目根目录下执行刚才我们定义的任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure><p>如果不出什么意外的话就会在根目录下面生成一个<code>dist</code>文件夹，里面有一个样式文件，内容如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>:-webkit-flex;</span><br><span class="line">  <span class="attribute">display</span>:-ms-flexbox;</span><br><span class="line">  <span class="attribute">display</span>:-webkit-box;</span><br><span class="line">  <span class="attribute">display</span>:flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"><span class="attribute">color</span>:<span class="number">#123456</span>;</span><br><span class="line"><span class="attribute">color</span>:<span class="built_in">rgba</span>(18, 52, 86, 0.47059);</span><br><span class="line"></span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">16px</span>;</span><br><span class="line"><span class="attribute">font-size</span>:<span class="number">1rem</span>;</span><br><span class="line"><span class="attribute">line-height</span>:<span class="number">24px</span>;</span><br><span class="line"><span class="attribute">line-height</span>:<span class="number">1.5rem</span>;</span><br><span class="line"><span class="attribute">padding</span>:<span class="built_in">calc</span>(0.5rem + 1px);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以看到我们写的样式自动添加了浏览器前缀，并且一些未来CSS语法也被转换了。</p><h2 id="了解PostCSS" class="post-heading"><a href="#了解PostCSS" class="headerlink" title="了解PostCSS"></a>了解PostCSS<a class="post-anchor" href="#了解PostCSS" aria-hidden="true"></a></h2><p>通过上面的实例我们应该知道<code>PostCSS</code>的使用方法，此时让我们先回想一下<code>CSS预处理器</code>的使用历程：</p><ol><li>学习该CSS预处理器的语法特性，诸如：变量定义、嵌套、继承</li><li>在特定后缀名(.less/.scss等)的文件按照上面的语法进行编写</li><li>通过Gulp/Grunt/Webpack等自动化工具或者手动编译成CSS样式</li></ol><p>而<code>PostCSS</code>的使用历程：</p><ol><li>直接按照CSS标准语法来书写CSS样式文件</li><li>通过Gulp/Grunt/Webpack等自动化工具加载PostCSS插件转换输出</li></ol><p>通过对比我们类比一个结论：<em>CSS预处理器好比给你一个工具箱，工具箱里面有什么东西该怎么拿已经跟你约定好，你必须按照这个规则来拿；而PostCSS好比给你一个盒子，你可以从旁边选择自己需要的工具放进盒子打包拿走，如果还不够用你可以自己造一个工具</em></p><h2 id="深入PostCSS" class="post-heading"><a href="#深入PostCSS" class="headerlink" title="深入PostCSS"></a>深入PostCSS<a class="post-anchor" href="#深入PostCSS" aria-hidden="true"></a></h2><p><code>PostCSS</code>自身只包括了<code>CSS分析器</code>，<code>CSS节点树API</code>，<code>source map生成器</code>，<code>CSS节点拼接器</code>，而基于<code>PostCSS</code>的插件都是使用了<code>CSS节点树API</code>来实现的。</p><p>我们都知道CSS的组成如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">element</span> &#123;</span><br><span class="line">  prop1 : rule1 rule2 ...;</span><br><span class="line">  <span class="selector-tag">prop2</span> : <span class="selector-tag">rule1</span> <span class="selector-tag">rule2</span> ...;</span><br><span class="line">  <span class="selector-tag">prop2</span> : <span class="selector-tag">rule1</span> <span class="selector-tag">rule2</span> ...;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也就是一条一条的样式规则组成，每一条样式规则包含一个或多个属性跟值。所以<code>PostCSS</code>的执行过程大致如下：</p><ol><li><p>Parser<br>利用<code>CSS分析器</code>读取CSS字符内容，得到一个完整的<code>节点树</code></p></li><li><p>Plugin<br>对上面拿到的<code>节点树</code>利用<code>CSS节点树API</code>进行一系列的转换操作</p></li><li><p>Plugin<br>利用<code>CSS节点拼接器</code>将上面转换之后的节点树重新组成CSS字符</p></li><li><p>Stringifier<br>在上面转换期间可利用<code>source map生成器</code>表明转换前后字符的对应关系</p></li></ol><h3 id="PostCSS性能" class="post-heading"><a href="#PostCSS性能" class="headerlink" title="PostCSS性能"></a>PostCSS性能<a class="post-anchor" href="#PostCSS性能" aria-hidden="true"></a></h3><p>在PostCSS官方推特上看到，由JavaScript编写的PostCSS比C++编写的libsass还要快3倍，下面来自官方推特的截图:</p><p><img src="//img30.360buyimg.com/ling/jfs/t1/83331/36/2048/81410/5d070378E8c5ab016/15bc1ce44aca1738.png" alt="PostCss"></p><p>如果你对上面的性能截图有疑问，可以亲自来<a href="https://github.com/postcss/benchmark" target="_blank" rel="noopener">这里</a>测试看看。</p><h3 id="开始编写自己的PostCSS插件" class="post-heading"><a href="#开始编写自己的PostCSS插件" class="headerlink" title="开始编写自己的PostCSS插件"></a>开始编写自己的PostCSS插件<a class="post-anchor" href="#开始编写自己的PostCSS插件" aria-hidden="true"></a></h3><p><code>PostCSS</code>在自己的<a href="https://github.com/postcss/postcss#plugins" target="_blank" rel="noopener">Github</a>上放了一些常用的插件，更多的插件可以在<a href="http://postcss.parts/" target="_blank" rel="noopener">postcss.parts</a>进行搜索。</p><p>但有时候已有的插件不满足我们的需求，这个时候需要编写自己的PostCSS插件，下面我们将一步步创建一个简单的插件，这个插件功能非常简单，如下：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">  文件位置：src/css/style.css</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,<span class="built_in">fontstack</span>(<span class="string">'Arial'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当输入上面的样式时，会生成下面的样式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  文件位置：dist/style.css</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,tahoma,arial;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="环境准备-1" class="post-heading"><a href="#环境准备-1" class="headerlink" title="环境准备"></a>环境准备<a class="post-anchor" href="#环境准备-1" aria-hidden="true"></a></h3><p>我们将以<code>Gulp</code>作为基础来实现我们的插件，首先创建项目文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-plugin &amp;&amp; <span class="built_in">cd</span> postcss-plugin</span><br></pre></td></tr></table></figure><p>然后快速创建<code>package.json</code>文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br></pre></td></tr></table></figure><p>紧接着先安装必备的包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gulp postcss gulp-postcss --save-dev -d</span><br></pre></td></tr></table></figure><p>再创建<code>gulpfile.js</code>并且输入下面内容:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="创建插件文件夹" class="post-heading"><a href="#创建插件文件夹" class="headerlink" title="创建插件文件夹"></a>创建插件文件夹<a class="post-anchor" href="#创建插件文件夹" aria-hidden="true"></a></h3><p>我们在执行<code>npm install</code>安装的包都放置在<code>node_modules</code>文件夹下面，这里我们创建PostCSS的插件文件夹，注意：<strong>PostCSS的插件命名格式为：postcss-插件名字</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里采用命令新建文件夹，你也可以手动创建</span></span><br><span class="line">mkdir node_modules/postcss-fontstack</span><br></pre></td></tr></table></figure><h3 id="创建插件入口文件" class="post-heading"><a href="#创建插件入口文件" class="headerlink" title="创建插件入口文件"></a>创建插件入口文件<a class="post-anchor" href="#创建插件入口文件" aria-hidden="true"></a></h3><p>现在我们可以在<code>postcss-fontstack</code>文件夹创建入口文件<code>index.js</code>，<code>PostCSS</code>创建插件的方式如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = postcss.plugin(<span class="string">'插件名字'</span>, <span class="function"><span class="keyword">function</span> 插件名字(<span class="params">选项</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//这里写插件代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>那我们可以在<code>index.js</code>里面贴入下面代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"></span><br><span class="line">modules.exports = postcss.plugin(<span class="string">'fontstack'</span>, <span class="function"><span class="keyword">function</span> <span class="title">fontstack</span>(<span class="params"> options </span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"> css </span>)</span>&#123;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fontstack_config = &#123;</span><br><span class="line">      <span class="string">'Arial'</span>: <span class="string">'tahoma,arial'</span>,</span><br><span class="line">      <span class="string">'Times New Roman'</span>: <span class="string">'TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">toTitleCase</span>(<span class="params"> str </span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> str.replace(<span class="regexp">/\w\S*/g</span>,<span class="function"><span class="keyword">function</span>(<span class="params"> txt </span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> txt.charAt(<span class="number">0</span>).toUpperCase() + txt.substr(<span class="number">1</span>).toLowerCase();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// css.walkRules方法用来遍历每一条css规则</span></span><br><span class="line">    css.walkRules( <span class="function"><span class="keyword">function</span>(<span class="params"> rule </span>)</span>&#123;</span><br><span class="line">        <span class="comment">// walkDecls方法用来解析属性跟值</span></span><br><span class="line">        rule.walkDecls( <span class="function"><span class="keyword">function</span>(<span class="params"> decl, i </span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value = decl.value;</span><br><span class="line">            <span class="keyword">if</span>( value.indexOf( <span class="string">'fontstack('</span> ) !== <span class="number">-1</span> )&#123;</span><br><span class="line">                <span class="keyword">var</span> fontstack_requested = value.match(<span class="regexp">/\(([^)]+)\)/</span>)[<span class="number">1</span>].replace(<span class="regexp">/["']/g</span>,<span class="string">""</span>);</span><br><span class="line">                fontstack_requested = toTitleCase( fontstack_requested );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> fontstack = fontstack_config[ fontstack_requested ];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> firstFont = value.substr( <span class="number">0</span>, value.indexOf(<span class="string">'fontstack('</span>) );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> newValue = firstFont + fontstack;</span><br><span class="line"></span><br><span class="line">                decl.value = newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>在<code>gulpfile.js</code>引入上面的插件，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="运行实例-1" class="post-heading"><a href="#运行实例-1" class="headerlink" title="运行实例"></a>运行实例<a class="post-anchor" href="#运行实例-1" aria-hidden="true"></a></h3><p>在项目根目录下运行实例，最终实现我们的效果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure><h2 id="再谈PostCSS" class="post-heading"><a href="#再谈PostCSS" class="headerlink" title="再谈PostCSS"></a>再谈PostCSS<a class="post-anchor" href="#再谈PostCSS" aria-hidden="true"></a></h2><p>基于<code>PostCSS</code>能够做到很多<code>CSS预处理器</code>做不到的事情，未来发展前景还是挺不错的，而且最新的<code>Atom</code>编辑器也可以下载插件来支持<code>PostCSS</code>这种语法。</p><p>但这就意味着<code>CSS预处理器</code>过时了么？不会。<code>PostCSS</code>的出现并不是为了替换掉之前的技术，只是提供多一种思路让我们去考虑，就比如Sass编译后再加<code>autoprefixer</code>自动补齐浏览器前缀这种做法当前还是比较流行的。</p><p>再回到文章最开始说的，<code>PostCSS</code>其实是在打造一个改变CSS开发方式的生态系统。也许暂时我们还是保持传统的开发方式，但未来对于<code>PostCSS</code>我还是保持关注，它是值得期待的。</p><div class="post-tags" style="display:none"><a href="/tags/Web开发/">Web开发</a></div><div class="post-categories" style="display:none"><a href="/cates/Web开发/">Web开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2015/10/13/start-postcss/">https://aotu.io/notes/2015/10/13/start-postcss/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-04-28T03:04:50.287Z">上次更新：2020-04-28 11:04:50</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2015/10/16/vim-list/" title="我的vim二三事">我的vim二三事 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2015/10/08/aotu-blog-v1/" title="凹凸实验室博客V1.0.0发布"><i class="fa fa-chevron-left"></i> 凹凸实验室博客V1.0.0发布</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxNS8xMC8xMy9zdGFydC1wb3N0Y3NzLw==",owner:"o2team",repo:"o2team.github.io",title:"PostCSS快速入门使用",body:"https://aotu.io/notes/2015/10/13/start-postcss/index.html\n\nPostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["cnt1992"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>