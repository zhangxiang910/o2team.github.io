<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Sketch 插件开发实践 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="CocoaScript,sketch 插件,skpm,Sketch,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2019/10/31/sketch-plugin/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="Sketch 是非常流行的 UI 设计工具，2014年随着 Sketch V43 版本增加 Symbols 功能、开放开发者权限，吸引了大批开发者的关注。 目前 Sketch 开发有两大热门课题：①  React 组件渲染成 sketch 由 airbnb 团队发起，② 使用 skpm 构建开发 Sketch 插件。 Sketch 插件开发相关资料较少且不太完善，我们开发插件过程中可以重点参考官"><meta name="keywords" content="Sketch,skpm,sketch 插件,CocoaScript"><meta property="og:type" content="article"><meta property="og:title" content="Sketch 插件开发实践"><meta property="og:url" content="https://aotu.io/notes/2019/10/31/sketch-plugin/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="Sketch 是非常流行的 UI 设计工具，2014年随着 Sketch V43 版本增加 Symbols 功能、开放开发者权限，吸引了大批开发者的关注。 目前 Sketch 开发有两大热门课题：①  React 组件渲染成 sketch 由 airbnb 团队发起，② 使用 skpm 构建开发 Sketch 插件。 Sketch 插件开发相关资料较少且不太完善，我们开发插件过程中可以重点参考官"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="http://img.pfan123.com/api-reference.png"><meta property="og:image" content="http://img.pfan123.com/nspanel.png"><meta property="og:image" content="http://img.pfan123.com/sketch-console.png"><meta property="og:updated_time" content="2020-04-28T03:04:50.303Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Sketch 插件开发实践"><meta name="twitter:description" content="Sketch 是非常流行的 UI 设计工具，2014年随着 Sketch V43 版本增加 Symbols 功能、开放开发者权限，吸引了大批开发者的关注。 目前 Sketch 开发有两大热门课题：①  React 组件渲染成 sketch 由 airbnb 团队发起，② 使用 skpm 构建开发 Sketch 插件。 Sketch 插件开发相关资料较少且不太完善，我们开发插件过程中可以重点参考官"><meta name="twitter:image" content="http://img.pfan123.com/api-reference.png"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="http://img.pfan123.com/sketch-plugins.jpg" alt="Sketch 插件开发实践"></div><header class="post-hd"><h1 class="post-tit">Sketch 插件开发实践</h1><div class="post-meta">by <a target="_blank" href="https://github.com/pfan123" class="post-author">高大师</a> on <span>2019-10-31</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>在做内部设计中台 quark 项目中，协作开发了Quark for Sketch 插件打通设计物料资产沉淀，在开发过程有许多经验总结，在此分享大家。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><a id="more"></a><p>Sketch 是非常流行的 UI 设计工具，2014年随着 Sketch V43 版本增加 Symbols 功能、开放开发者权限，吸引了大批开发者的关注。</p><p>目前 Sketch 开发有两大热门课题：① <a href="https://github.com/airbnb/react-sketchapp" target="_blank" rel="noopener">React 组件渲染成 sketch</a> 由 airbnb 团队发起，② 使用 <a href="https://github.com/skpm/skpm" target="_blank" rel="noopener">skpm</a> 构建开发 Sketch 插件。</p><p>Sketch 插件开发相关资料较少且不太完善，我们开发插件过程中可以重点参考官方文档，只是有些陈旧。官方有提供 JavaScript API 借助 CocoaScript bridge 访问内部 Sketch API 和 macOS 框架进行开发插件（Sketch 53~56 版 JS API 在 native MacOS 和 Sketch API 暴露的<a href="https://developer.sketchapp.boltdoggy.com/guides/cocoascript/" target="_blank" rel="noopener">特殊环境</a>中运行），提供的底层 API 功能有些薄弱，更深入的就需要了解掌握 <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Introduction/Introduction.html" target="_blank" rel="noopener">Objective-C</a> 、 <a href="http://link.zhihu.com/?target=https%3A//github.com/ccgus/CocoaScrip" target="_blank" rel="noopener">CocoaScript</a> 、<a href="https://developer.apple.com/documentation/appkit" target="_blank" rel="noopener">AppKit</a>、<a href="https://link.jianshu.com/?t=https://github.com/abynim/Sketch-Headers" target="_blank" rel="noopener">Sketch-Headers</a>。</p><h2 id="Sketch-插件结构" class="post-heading"><a href="#Sketch-插件结构" class="headerlink" title="Sketch 插件结构"></a>Sketch 插件结构<a class="post-anchor" href="#Sketch-插件结构" aria-hidden="true"></a></h2><p>Sketch Plugin 是一个或多个 <strong>scripts</strong> 的集合，每个 script 定义一个或多个 <strong>commands</strong>。Sketch Plugin 是以 <code>.sketchplugin</code> 扩展名的文件夹，包含文件和子文件夹。严格来说，Plugin 实际上是 <a href="https://developer.apple.com/library/mac/documentation/CoreFoundation/Conceptual/CFBundles/DocumentPackages/DocumentPackages.html#//apple_ref/doc/uid/10000123i-CH106-SW1" target="_blank" rel="noopener">OS X package</a>，用作为 <a href="https://developer.apple.com/library/mac/documentation/CoreFoundation/Conceptual/CFBundles/AboutBundles/AboutBundles.html#//apple_ref/doc/uid/10000123i-CH100-SW1" target="_blank" rel="noopener">OS X bundle</a>。</p><p>Bundle 具有标准化分层结构的目录，其保存可执行代码和该代码使用的资源。</p><h3 id="Plugin-Bundle-文件夹结构" class="post-heading"><a href="#Plugin-Bundle-文件夹结构" class="headerlink" title="Plugin Bundle 文件夹结构"></a>Plugin Bundle 文件夹结构<a class="post-anchor" href="#Plugin-Bundle-文件夹结构" aria-hidden="true"></a></h3><p>Bundles 包含一个 <code>manifest.json</code> 文件，一个或多个 <strong>scripts</strong> 文件（包含用 CocoaScript 或 JavaScript 编写的脚本），它实现了 Plugins 菜单中显示的命令，以及任意数量的共享库脚本和资源文件。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mrwalker.sketchplugin</span><br><span class="line">  Contents/</span><br><span class="line">    Sketch/</span><br><span class="line">      manifest.json</span><br><span class="line">      shared.js</span><br><span class="line">      Select <span class="module-access"><span class="module"><span class="identifier">Circles</span>.</span></span>cocoascript</span><br><span class="line">      Select <span class="module-access"><span class="module"><span class="identifier">Rectangles</span>.</span></span>cocoascript</span><br><span class="line">    Resources/</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">Screenshot</span>.</span></span>png</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">Icon</span>.</span></span>png</span><br></pre></td></tr></table></figure><p>最关键的文件是 <code>manifest.json</code> 文件，提供有关插件的信息。</p><blockquote><p>小贴士：</p><p>Sketch 插件包可以使用 <a href="https://skpm.io/" target="_blank" rel="noopener">skpm</a> 在构建过程中生成，skpm 提供 Sketch 官方插件模版:</p><ul><li><a href="https://github.com/skpm/skpm/tree/master/template" target="_blank" rel="noopener"><code>skpm/skpm</code></a> - The simplest possible plugin setup. (<em>default</em>)</li><li><a href="https://github.com/skpm/with-prettier" target="_blank" rel="noopener"><code>skpm/with-prettier</code></a> - A plugin setup featuring linting with ESLint and code formatting with Prettier.</li><li><a href="https://github.com/skpm/with-datasupplier" target="_blank" rel="noopener"><code>skpm/with-datasupplier</code></a> - A template to create DataSupplier plugins (check <a href="https://blog.sketchapp.com/do-more-with-data-2b765e870e4f" target="_blank" rel="noopener">our blog</a> for more info)</li><li><a href="https://github.com/skpm/with-webview" target="_blank" rel="noopener"><code>skpm/with-webview</code></a> - A template to create plugins displaying some rich UI in a WebView (check <a href="https://github.com/skpm/sketch-module-web-view" target="_blank" rel="noopener">sketch-module-web-view</a> for more info)</li></ul><p>💁 Tip: Any Github repo with a ‘template’ folder can be used as a custom template:</p><p><code>skpm create &lt;project-name&gt; --template=&lt;username&gt;/&lt;repository&gt;</code></p></blockquote><h3 id="Manifest" class="post-heading"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest<a class="post-anchor" href="#Manifest" aria-hidden="true"></a></h3><p><code>manifest.json</code> 文件提供有关插件的信息，例如作者，描述，图标、从何处获取最新更新、定义的命令 <strong>(commands） </strong>、调用菜单项 <strong>(menu)</strong> 以及资源的元数据。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Select Shapes"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"Plugins to select and deselect shapes"</span>,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"Joe Bloggs"</span>,</span><br><span class="line">  <span class="attr">"homepage"</span>: <span class="string">"https://github.com/example/sketchplugins"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">  <span class="attr">"identifier"</span>: <span class="string">"com.example.sketch.shape-plugins"</span>,</span><br><span class="line">  <span class="attr">"appcast"</span>: <span class="string">"https://excellent.sketchplugin.com/excellent-plugin-appcast.xml"</span>,</span><br><span class="line">  <span class="attr">"compatibleVersion"</span>: <span class="string">"3"</span>,</span><br><span class="line">  <span class="attr">"bundleVersion"</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"commands"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"All"</span>,</span><br><span class="line">      <span class="attr">"identifier"</span>: <span class="string">"all"</span>,</span><br><span class="line">      <span class="attr">"shortcut"</span>: <span class="string">"ctrl shift a"</span>,</span><br><span class="line">      <span class="attr">"script"</span>: <span class="string">"shared.js"</span>,</span><br><span class="line">      <span class="attr">"handler"</span>: <span class="string">"selectAll"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"Circles"</span>,</span><br><span class="line">      <span class="attr">"identifier"</span>: <span class="string">"circles"</span>,</span><br><span class="line">      <span class="attr">"script"</span>: <span class="string">"Select Circles.cocoascript"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"Rectangles"</span>,</span><br><span class="line">      <span class="attr">"identifier"</span>: <span class="string">"rectangles"</span>,</span><br><span class="line">      <span class="attr">"script"</span>: <span class="string">"Select Rectangles.cocoascript"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"menu"</span>: &#123;</span><br><span class="line">    <span class="attr">"items"</span>: [<span class="string">"all"</span>, <span class="string">"circles"</span>, <span class="string">"rectangles"</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Commands" class="post-heading"><a href="#Commands" class="headerlink" title="Commands"></a>Commands<a class="post-anchor" href="#Commands" aria-hidden="true"></a></h3><p>声明一组 command 的信息，每个 command 以 <code>Dictionary</code> 数据结构形式存在。</p><ul><li>script : 实现命令功能的函数所在的脚本</li><li>handler : 函数名，该函数实现命令的功能。Sketch 在调用该函数时，会传入 <code>context</code> 上下文参数。若未指定 handler，Sketch 会默认调用对应 script 中 <code>onRun</code> 函数</li><li>shortcut：命令的快捷键</li><li>name：显示在 Sketch Plugin 菜单中</li><li>identifier : 唯一标识，建议用 <code>com.xxxx.xxx</code> 格式，不要过长</li></ul><h3 id="Menu" class="post-heading"><a href="#Menu" class="headerlink" title="Menu"></a>Menu<a class="post-anchor" href="#Menu" aria-hidden="true"></a></h3><p>Sketch 加载插件会根据指定的信息，在菜单栏中有序显示命令名。</p><p>在了解了 Sketch 插件结构之后，我们再来了解一下，sketch提供的官方 API： Actions API， Javascript API。</p><h2 id="Sketch-Actions-API" class="post-heading"><a href="#Sketch-Actions-API" class="headerlink" title="Sketch Actions API"></a>Sketch Actions API<a class="post-anchor" href="#Sketch-Actions-API" aria-hidden="true"></a></h2><p>Sketch Actions API 用于监听用户操作行为而触发事件，例如 OpenDocumen（打开文档）、CloseDocument（关闭文档）、Shutdown（关闭插件）、TextChanged（文本变化）等，具体详见官网：<a href="https://developer.sketch.com/reference/action/" target="_blank" rel="noopener">https://developer.sketch.com/reference/action/</a></p><ul><li>register Actions</li></ul><p>manifest.json 文件，配置相应 handlers。</p><p>示例：当 OpenDocument 事件被触发时调用 onOpenDocument handler 。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"commands"</span> : [</span><br><span class="line">  ...</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"script"</span> : <span class="string">"my-action-listener.js"</span>,</span><br><span class="line">    <span class="string">"name"</span> : <span class="string">"My Action Listener"</span>,</span><br><span class="line">    <span class="string">"handlers"</span> : &#123;</span><br><span class="line">      <span class="string">"actions"</span>: &#123;</span><br><span class="line">        <span class="string">"OpenDocument"</span>: <span class="string">"onOpenDocument"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"identifier"</span> : <span class="string">"my-action-listener-identifier"</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">],</span><br></pre></td></tr></table></figure><p><strong>my-action-listener.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onOpenDocument</span>(<span class="params">context</span>) </span>&#123;  	  		</span><br><span class="line">  context.actionContext.document.showMessage(<span class="string">'Document Opened'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Action Context</li></ul><p>Action 事件触发时会将 <code>context.actionContext</code> 传递给相应 <code>handler</code>。注意有些 Action 包含两个状态<code>begin</code> 和 <code>finish</code>，例如 <code>SelectionChanged</code>，需分别订阅 <code>SelectionChanged.begin</code> 和 <code>SelectionChanged.finish</code>，否则会触发两次事件。</p><h2 id="Sketch-JS-API" class="post-heading"><a href="#Sketch-JS-API" class="headerlink" title="Sketch JS API"></a>Sketch JS API<a class="post-anchor" href="#Sketch-JS-API" aria-hidden="true"></a></h2><p>Sketch 插件开发大概有如下三种方式：① 纯使用 CocoaScript 脚本进行开发，② 通过 Javascript + CocoaScript 的混合开发模式， ③ 通过 AppKit + Objective-C 进行开发。Sketch 官方建议使用 JavaScript API 编写 Sketch 插件，且官方针对 Sketch Native API 封装了一套 <a href="https://developer.sketch.com/reference/api/" target="_blank" rel="noopener">JS API</a>，目前还未涵盖所有场景， 若需要更丰富的底层 API 需结合 CocoaScript 进行实现。通过 <a href="https://developer.sketch.com/reference/api/" target="_blank" rel="noopener">JS API</a> 可以很方便的对 Sketch 中 <code>Document</code>、<code>Artboard</code>、<code>Group</code>、<code>Layer</code> 进行相关操作以及导入导出等，可能需要考虑兼容性，<a href="https://developer.sketch.com/reference/api/" target="_blank" rel="noopener"> JS API</a> 原理图如下：</p><p><img src="http://img.pfan123.com/api-reference.png" alt="api-reference"></p><h3 id="CocoaScript" class="post-heading"><a href="#CocoaScript" class="headerlink" title="CocoaScript"></a>CocoaScript<a class="post-anchor" href="#CocoaScript" aria-hidden="true"></a></h3><p><a href="https://github.com/ccgus/CocoaScript" target="_blank" rel="noopener">CocoaScript</a> 实现 JavaScript 运行环境到 Objective-C 运行时的桥接功能，可通过桥接器编写 JavaScript 外部脚本访问内部 Sketch API 和 macOS 框架底层丰富的 API 功能。</p><blockquote><p>小贴士：</p><p><a href="https://github.com/logancollins/Mocha" target="_blank" rel="noopener">Mocha</a> 实现提供 JavaScript 运行环境到 Objective-C 运行时的桥接功能已包含在CocoaScript中。</p><p>CocoaScript 建立在 Apple 的 JavaScriptCore 之上，而 JavaScriptCore 是为 Safari 提供支持的 JavaScript 引擎，使用 CocoaScript 编写代码实际上就是在编写 JavaScript。CocoaScript 包括桥接器，可以从 JavaScript 访问 Apple 的 Cocoa 框架。</p></blockquote><p>借助 CocoaScript 使用 JavaScript 调 Objective-C 语法:</p><ul><li>方法调用用 ‘.’ 语法</li><li>Objective-C 属性设置<ul><li>Getter: <code>object.name()</code></li><li>Setter: <code>object.setName(&#39;Sketch&#39;)</code>，<code>object.name=&#39;sketch&#39;</code></li></ul></li><li>参数都放在 ‘ ( ) ’ 里</li><li>Objective-C 中 ‘ : ‘（参数与函数名分割符） 转换为 ‘ _ ‘，最后一个下划线是可选的</li><li>返回值，JavaScript 统一用 <code>var/const/let</code> 设置类型</li></ul><blockquote><p>注意：详细 Objective-C to JavaScript 请参考 <a href="https://github.com/logancollins/Mocha" target="_blank" rel="noopener">Mocha 文档</a></p></blockquote><p>示例:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// oc: MSPlugin 的接口 valueForKey:onLayer:</span></span><br><span class="line">NSString * value = [command valueForKey:kAutoresizingMask onLayer:currentLayer];</span><br><span class="line"></span><br><span class="line"><span class="comment">// cocoascript:</span></span><br><span class="line"><span class="keyword">const</span> value = command.valueForKey_onLayer(kAutoresizingMask, currentLayer);</span><br><span class="line"></span><br><span class="line"><span class="comment">// oc:</span></span><br><span class="line"><span class="keyword">const</span> app = [NSApplication sharedApplication];</span><br><span class="line">[app displayDialog:msg withTitle:title];</span><br><span class="line"></span><br><span class="line"><span class="comment">// cocoascript:</span></span><br><span class="line"><span class="keyword">const</span> app = NSApplication.sharedApplication();</span><br><span class="line">app.displayDialog_withTitle(msg, title)</span><br><span class="line"></span><br><span class="line"><span class="comment">// oc:</span></span><br><span class="line"><span class="keyword">const</span> openPanel = [NSOpenPanel openPanel]</span><br><span class="line">[openPanel setTitle: <span class="string">"Choose a location…"</span>]</span><br><span class="line">[openPanel setPrompt: <span class="string">"Export"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// cocoascript:</span></span><br><span class="line"><span class="keyword">const</span> openPanel = NSOpenPanel.openPanel</span><br><span class="line">openPanel.setTitle(<span class="string">"Choose a location…"</span>)</span><br><span class="line">openPanel.setPrompt(<span class="string">"Export"</span>)</span><br></pre></td></tr></table></figure><h3 id="Objective-C-Classes" class="post-heading"><a href="#Objective-C-Classes" class="headerlink" title="Objective-C Classes"></a><strong>Objective-C Classes</strong><a class="post-anchor" href="#Objective-C-Classes" aria-hidden="true"></a></h3><p>Sketch 插件系统可以完全访问应用程序的内部结构和 macOS 中的核心框架。Sketch 是用 Objective-C 构建的，其 Objective-C 类通过 Bridge (CocoaScript/mocha) 提供 Javascript API 调用，简单的了解 Sketch 暴露的相关类以及类方法，对我们开发插件非常有帮助。</p><p>使用 Bridge 定义的一些内省方法来访问以下信息：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>(context.document.class()) <span class="comment">// MSDocument</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mocha = context.document.class().mocha()</span><br><span class="line"></span><br><span class="line">mocha.properties() <span class="comment">// array of MSDocument specific properties defined on a MSDocument instance</span></span><br><span class="line">mocha.propertiesWithAncestors() <span class="comment">// array of all the properties defined on a MSDocument instance</span></span><br><span class="line"></span><br><span class="line">mocha.instanceMethods() <span class="comment">// array of methods defined on a MSDocument instance</span></span><br><span class="line">mocha.instanceMethodsWithAncestors()</span><br><span class="line"></span><br><span class="line">mocha.classMethods() <span class="comment">// array of methods defined on the MSDocument class</span></span><br><span class="line">mocha.classMethodsWithAncestors()</span><br><span class="line"></span><br><span class="line">mocha.protocols() <span class="comment">// array of protocols the MSDocument class inherits from</span></span><br><span class="line">mocha.protocolsWithAncestors()</span><br></pre></td></tr></table></figure><h3 id="Context" class="post-heading"><a href="#Context" class="headerlink" title="Context"></a>Context<a class="post-anchor" href="#Context" aria-hidden="true"></a></h3><p>当输入插件定制的命令时，Sketch 会去寻找改命令对应的实现函数， 并传入 <code>context</code> 变量。<code>context</code>包含以下变量：</p><ul><li><strong>command</strong>: <a href="https://link.jianshu.com/?t=http://developer.sketchapp.com/reference/MSPluginCommand/" target="_blank" rel="noopener"><code>MSPluginCommand</code></a> 对象，当前执行命令</li><li><strong>document</strong>: <a href="https://link.jianshu.com/?t=http://developer.sketchapp.com/reference/MSDocument/" target="_blank" rel="noopener"><code>MSDocument</code></a> 对象 ，当前文档</li><li><strong>plugin</strong>: <a href="https://link.jianshu.com/?t=http://developer.sketchapp.com/reference/MSPluginBundle/" target="_blank" rel="noopener"><code>MSPluginBundle</code></a> 对象，当前的插件 bundle，包含当前运行的脚本</li><li><strong>scriptPath</strong>: <code>NSString</code> 当前执行脚本的绝对路径</li><li><strong>scriptURL</strong>: 当前执行脚本的绝对路径，跟 <strong>scriptPath </strong>不同的是它是个 <code>NSURL</code> 对象</li><li><strong>selection</strong>: 一个 <code>NSArray</code> 对象，包含了当前选择的所有图层。数组中的每一个元素都是 <a href="https://link.jianshu.com/?t=http://developer.sketchapp.com/reference/MSLayer/" target="_blank" rel="noopener"><code>MSLayer</code></a> 对象</li></ul><blockquote><p>小贴士：MS 打头类名为 Sketch 封装类如图层基类 <a href="[https://github.com/abynim/Sketch-Headers/blob/master/Headers/MSLayer.h](https://link.jianshu.com/?t=https://github.com/abynim/Sketch-Headers/blob/master/Headers/MSLayer.h">MSLayer</a>)、文本层基类 <a href="[https://github.com/abynim/Sketch-Headers/blob/master/Headers/MSTextLayer.h](https://link.jianshu.com/?t=https://github.com/abynim/Sketch-Headers/blob/master/Headers/MSTextLayer.h">MSTextLayer</a>) 、位图层基类 <a href="https://github.com/abynim/Sketch-Headers/blob/master/Headers/MSBitmapLayer.h" target="_blank" rel="noopener">MSBitmapLayer</a>，NS 打头为 AppKit 中含有的类</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = NSApplication.sharedApplication()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initContext</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">		context.document.showMessage(<span class="string">'初始执行脚本'</span>)</span><br><span class="line">		</span><br><span class="line">    <span class="keyword">const</span> doc = context.document</span><br><span class="line">    <span class="keyword">const</span> page = doc.currentPage()</span><br><span class="line">    <span class="keyword">const</span> artboards = page.artboards()</span><br><span class="line">    <span class="keyword">const</span> selectedArtboard = page.currentArtboard() <span class="comment">// 当前被选择的画板</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> plugin = context.plugin</span><br><span class="line">    <span class="keyword">const</span> command = context.command</span><br><span class="line">    <span class="keyword">const</span> scriptPath = context.scriptPath</span><br><span class="line">    <span class="keyword">const</span> scriptURL = context.scriptURL</span><br><span class="line">    <span class="keyword">const</span> selection = context.selection <span class="comment">// 被选择的图层</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Sketch-插件开发上手" class="post-heading"><a href="#Sketch-插件开发上手" class="headerlink" title="Sketch 插件开发上手"></a>Sketch 插件开发上手<a class="post-anchor" href="#Sketch-插件开发上手" aria-hidden="true"></a></h2><p>前面我们了解了许多 Sketch 插件开发知识，那接下来实际上手两个小例子： <strong>① 创建辅助内容面板窗口</strong>， ② <strong>侧边栏导航</strong>。为了方便开发，我们在开发前需先进行如下操作：</p><p><strong>崩溃保护</strong></p><p>当 Sketch 运行发生崩溃，它会停用所有插件以避免循环崩溃。对于使用者，每次崩溃重启后手动在菜单栏启用所需插件非常繁琐。因此可以通过如下命令禁用该特性。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.bohemiancoding.sketch3 disableAutomaticSafeMode <span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>插件缓存</strong></p><p>通过配置启用或禁用缓存机制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.bohemiancoding.sketch3 AlwaysReloadScript -bool YES</span><br></pre></td></tr></table></figure><p>该方法对于某些场景并不适用，如设置 <code>COScript.currentCOScript().setShouldKeepAround(true)</code> 区块会保持常驻在内存，那么则需要通过 <code>coscript.setShouldKeepAround(false)</code> 进行释放。</p><p><strong>WebView 调试</strong></p><p>如果插件实现方案使用 WebView 做界面，可通过以下配置开启调试功能。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.bohemiancoding.sketch3 WebKitDeveloperExtras -bool YES</span><br></pre></td></tr></table></figure><h4 id="创建辅助内容面板窗口" class="post-heading"><a href="#创建辅助内容面板窗口" class="headerlink" title="创建辅助内容面板窗口"></a>创建辅助内容面板窗口<a class="post-anchor" href="#创建辅助内容面板窗口" aria-hidden="true"></a></h4><p>首先我们先熟悉一下 macOS 下的辅助内容面板， 如下图最左侧 NSPanel 样例， 它是有展示区域，可设置样式效果，左上角有可操作按钮的辅助窗口。</p><p>Sketch 中要创建如下内容面板，需要使用 macOS 下 <code>AppKit</code> 框架中 <code>NSPanel</code> 类，它是 <code>NSWindow</code> 的子类，用于创建辅助窗口。内容面板外观样式设置，可通过 <code>NSPanel</code> 类相关属性进行设置， 也可通过 <code>AppKit</code> 的<code>NSVisualEffectView</code> 类添加模糊的背景效果。内容区域则可通过 <code>AppKit</code> 的 <code>WKWebView</code> 类，单开 <code>webview</code> 渲染网页内容展示。</p><p><img src="http://img.pfan123.com/nspanel.png" alt="console"></p><ul><li>创建 Panel</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> panelWidth = <span class="number">80</span>;</span><br><span class="line"><span class="keyword">const</span> panelHeight = <span class="number">240</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create the panel and set its appearance</span></span><br><span class="line"><span class="keyword">const</span> panel = NSPanel.alloc().init();</span><br><span class="line">panel.setFrame_display(NSMakeRect(<span class="number">0</span>, <span class="number">0</span>, panelWidth, panelHeight), <span class="literal">true</span>);</span><br><span class="line">panel.setStyleMask(NSTexturedBackgroundWindowMask | NSTitledWindowMask | NSClosableWindowMask | NSFullSizeContentViewWindowMask);</span><br><span class="line">panel.setBackgroundColor(NSColor.whiteColor());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the panel's title and title bar appearance</span></span><br><span class="line">panel.title = <span class="string">""</span>;</span><br><span class="line">panel.titlebarAppearsTransparent = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Center and focus the panel</span></span><br><span class="line">panel.center();</span><br><span class="line">panel.makeKeyAndOrderFront(<span class="literal">null</span>);</span><br><span class="line">panel.setLevel(NSFloatingWindowLevel);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make the plugin's code stick around (since it's a floating panel)</span></span><br><span class="line">COScript.currentCOScript().setShouldKeepAround(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hide the Minimize and Zoom button</span></span><br><span class="line">panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(<span class="literal">true</span>);</span><br><span class="line">panel.standardWindowButton(NSWindowZoomButton).setHidden(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><ul><li>Panel 添加模糊的背景</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create the blurred background</span></span><br><span class="line"><span class="keyword">const</span> vibrancy = NSVisualEffectView.alloc().initWithFrame(NSMakeRect(<span class="number">0</span>, <span class="number">0</span>, panelWidth, panelHeight));</span><br><span class="line">vibrancy.setAppearance(NSAppearance.appearanceNamed(NSAppearanceNameVibrantLight));</span><br><span class="line">vibrancy.setBlendingMode(NSVisualEffectBlendingModeBehindWindow);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add it to the panel</span></span><br><span class="line">panel.contentView().addSubview(vibrancy);</span><br></pre></td></tr></table></figure><ul><li>Panel 插入 <code>webview</code> 渲染</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wkwebviewConfig = WKWebViewConfiguration.alloc().init()</span><br><span class="line"><span class="keyword">const</span> webView = WKWebView.alloc().initWithFrame_configuration(</span><br><span class="line">  CGRectMake(<span class="number">0</span>, <span class="number">0</span>, panelWidth, panelWidth),</span><br><span class="line">  wkwebviewConfig</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add it to the panel</span></span><br><span class="line">panel.contentView().addSubview(webView);</span><br><span class="line"></span><br><span class="line"><span class="comment">// load file URL</span></span><br><span class="line">webview.loadFileURL_allowingReadAccessToURL(</span><br><span class="line">  NSURL.URLWithString(url),</span><br><span class="line">  NSURL.URLWithString(<span class="string">'file:///'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="侧边栏导航开发" class="post-heading"><a href="#侧边栏导航开发" class="headerlink" title="侧边栏导航开发"></a>侧边栏导航开发<a class="post-anchor" href="#侧边栏导航开发" aria-hidden="true"></a></h4><p>我们开发复杂的 Sketch 插件，一般都要开发侧边栏导航展示插件功能按钮，点击触发相关操作。那开发侧边栏导航，我们主要使用 <code>AppKit</code> 中的那些类呢，有 <code>NSStackView</code> 、 <code>NSBox</code> 、<code>NSImage</code>、 <code>NSImageView</code>、<code>NSButton</code> 等，大致核心代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// create toolbar</span></span><br><span class="line"> <span class="keyword">const</span> toolbar = NSStackView.alloc().initWithFrame(NSMakeRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">400</span>))</span><br><span class="line"> threadDictionary[SidePanelIdentifier] = toolbar</span><br><span class="line"> toolbar.identifier = SidePanelIdentifier</span><br><span class="line"> toolbar.setSpacing(<span class="number">8</span>)</span><br><span class="line"> toolbar.setFlipped(<span class="literal">true</span>)</span><br><span class="line"> toolbar.setBackgroundColor(NSColor.windowBackgroundColor())</span><br><span class="line"> toolbar.orientation = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// add element</span></span><br><span class="line"> toolbar.addView_inGravity(createImageView(NSMakeRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">22</span>), <span class="string">'transparent'</span>, NSMakeSize(<span class="number">40</span>, <span class="number">22</span>)), <span class="number">1</span>)</span><br><span class="line"> <span class="keyword">const</span> Logo = createImageView(NSMakeRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">40</span>, <span class="number">30</span>), <span class="string">'logo'</span>, NSMakeSize(<span class="number">40</span>, <span class="number">28</span>))</span><br><span class="line"> toolbar.addSubview(Logo)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> contentView = context.document.documentWindow().contentView()</span><br><span class="line"> <span class="keyword">const</span> stageView = contentView.subviews().objectAtIndex(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> views = stageView.subviews()</span><br><span class="line"> <span class="keyword">const</span> existId = views.find(<span class="function"><span class="params">d</span> =&gt;</span> <span class="string">''</span>.concat(d.identifier()) === identifier)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> finalViews = []</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; views.count(); i++) &#123;</span><br><span class="line">   <span class="keyword">const</span> view = views[i]</span><br><span class="line">   <span class="keyword">if</span> (existId) &#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="string">''</span>.concat(view.identifier()) !== identifier) finalViews.push(view)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     finalViews.push(view)</span><br><span class="line">     <span class="keyword">if</span> (<span class="string">''</span>.concat(view.identifier()) === <span class="string">'view_canvas'</span>) &#123;</span><br><span class="line">       finalViews.push(toolbar)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add to main Window</span></span><br><span class="line"> stageView.subviews = finalViews</span><br><span class="line"> stageView.adjustSubviews()</span><br></pre></td></tr></table></figure><p>详细见开源代码： <a href="https://github.com/o2team/sketch-plugin-boilerplate" target="_blank" rel="noopener">https://github.com/o2team/sketch-plugin-boilerplate</a> （欢迎 star 交流）</p><h2 id="调试" class="post-heading"><a href="#调试" class="headerlink" title="调试"></a>调试<a class="post-anchor" href="#调试" aria-hidden="true"></a></h2><p>当插件运行时，Sketch 将会创建一个与其关联的 JavaScript 上下文，可以使用 Safari 来调试该上下文。</p><p>在 Safari 中, 打开 <code>Developer</code> &gt; <em>你的机器名称</em> &gt; <code>Automatically Show Web Inspector for JSContexts</code>，同时启用选项 <code>Automatically Pause Connecting to JSContext</code>，否则检查器将在可以交互之前关闭（当脚本运行完时上下文会被销毁）。</p><p>现在就可以在代码中使用断点了，也可以在运行时检查变量的值等等。</p><h2 id="日志" class="post-heading"><a href="#日志" class="headerlink" title="日志"></a>日志<a class="post-anchor" href="#日志" aria-hidden="true"></a></h2><p>JavaScriptCore <a href="https://developer.sketchapp.com/guides/cocoascript/" target="_blank" rel="noopener">运行 Sketch 插件的环境</a> 也有提供类似调试 JavaScript 代码打 log 的方式，我们可以在关键步骤处放入一堆 <code>console.log/console.error</code> 等进行落点日志查看。</p><p>有以下几种选择可以查看日志：</p><ul><li>打开 Console.app 并查找 Sketch 日志</li><li>查看 <code>~/Library/Logs/com.bohemiancoding.sketch3/Plugin Output.log</code> 文件</li><li>运行 <code>skpm log</code> 命令，该命令可以输出上面的文件（执行 <code>skpm log -f</code> 可以流式地输出日志）</li><li><p>使用 skpm 开发的插件，安装 <a href="https://github.com/skpm/sketch-dev-tools" target="_blank" rel="noopener">sketch-dev-tools</a>，使用 <code>console.log</code> 打日志查看。</p><p><img src="http://img.pfan123.com/sketch-console.png" alt="console"></p></li></ul><h2 id="SketchTool" class="post-heading"><a href="#SketchTool" class="headerlink" title="SketchTool"></a>SketchTool<a class="post-anchor" href="#SketchTool" aria-hidden="true"></a></h2><p>SketchTool 包含在 Sketch 中的 CLI 工具，通过 SketchTool 可对 Sketch 文档执行相关操作：</p><ul><li><a href="https://developer.sketch.com/cli/export-assets" target="_blank" rel="noopener">导出 artboards、layers、slices、pages、交互稿</a></li><li><a href="https://developer.sketch.com/cli/inspect-document" target="_blank" rel="noopener">检查 Sketch 文档</a></li><li><a href="https://developer.sketch.com/cli/dump" target="_blank" rel="noopener">导出 Sketch 文档 JSON data</a></li><li><a href="https://developer.sketch.com/cli/run-plugin" target="_blank" rel="noopener">Run plugins</a></li></ul><p>sketchtool 二进制文件位于 Sketch 应用程序包中：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sketch.app<span class="regexp">/Contents/</span>Resources<span class="regexp">/sketchtool/</span>bin<span class="regexp">/sketchtool</span></span><br></pre></td></tr></table></figure><p>设置 <code>alias</code> ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> sketchtool=<span class="string">"/Applications/Sketch.app/Contents/Resources/sketchtool/bin/sketchtool"</span></span><br></pre></td></tr></table></figure><p>使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sketchtool -h  <span class="comment"># 查看帮助</span></span><br><span class="line">sketchtool <span class="built_in">export</span> artboards path/to/document.sketch  <span class="comment"># 导出画板</span></span><br><span class="line">sketchtool dump path/to/document.sketch <span class="comment"># 导出 Sketch 文档 JSON data</span></span><br><span class="line">sketchtool metadata path/to/document.sketch <span class="comment"># 查看 Sketch 文档元数据</span></span><br><span class="line">sketchtool run [Plugin path] <span class="comment"># 运行插件</span></span><br></pre></td></tr></table></figure><p><code>注意</code>：SketchTool 需要 OSX 10.11或更高版本。</p><h2 id="Other-Resources" class="post-heading"><a href="#Other-Resources" class="headerlink" title="Other Resources"></a>Other Resources<a class="post-anchor" href="#Other-Resources" aria-hidden="true"></a></h2><p><a href="https://developer.sketch.com/plugins/" target="_blank" rel="noopener">sketch Plugin 开发官方文档</a></p><p><a href="https://developer.sketchapp.boltdoggy.com/" target="_blank" rel="noopener">sketch插件开发中文文档</a></p><p><a href="https://www.sketch.com/docs/" target="_blank" rel="noopener">sketch 使用文档</a></p><p><a href="https://github.com/skpm/sketch-utils" target="_blank" rel="noopener">sketch-utils</a></p><p><a href="https://developer.sketch.com/reference/api/" target="_blank" rel="noopener">sketch reference api</a></p><p><a href="https://github.com/BohemianCoding/SketchAPI" target="_blank" rel="noopener">Github SketchAPI</a></p><p><a href="https://github.com/airbnb/react-sketchapp" target="_blank" rel="noopener">react-sketchapp</a></p><p><a href="https://github.com/turbobabr/Sketch-Plugins-Cookbook" target="_blank" rel="noopener">Sketch-Plugins-Cookbook</a></p><p><a href="https://github.com/qinjx/30min_guides/blob/master/ios.md" target="_blank" rel="noopener">iOS开发60分钟入门</a></p><p><a href="https://developer.apple.com/documentation/appkit?language=objc" target="_blank" rel="noopener">AppKit, 构建 Sketch 的一个主要 Apple 框架</a></p><p><a href="https://developer.apple.com/documentation/foundation?language=objc" target="_blank" rel="noopener">Foundation(基础), 更重要的 Apple 课程和服务</a></p><p><a href="http://eon.codes/blog/2016/01/23/Chromeless-window/" target="_blank" rel="noopener">Chromeless-window</a></p><div class="post-tags" style="display:none"><a href="/tags/Sketch/">Sketch</a> <a href="/tags/skpm/">skpm</a> <a href="/tags/sketch-插件/">sketch 插件</a> <a href="/tags/CocoaScript/">CocoaScript</a></div><div class="post-categories" style="display:none"><a href="/cates/Web开发/">Web开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2019/10/31/sketch-plugin/">https://aotu.io/notes/2019/10/31/sketch-plugin/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-04-28T03:04:50.303Z">上次更新：2020-04-28 11:04:50</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2019/12/03/jingxi-index/" title="京喜首页（微信购物入口）跨端开发与优化实践">京喜首页（微信购物入口）跨端开发与优化实践 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2019/10/29/css-preprocessor/" title="2019年，你是否可以抛弃 CSS 预处理器？"><i class="fa fa-chevron-left"></i> 2019年，你是否可以抛弃 CSS 预处理器？</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAxOS8xMC8zMS9za2V0Y2gtcGx1Z2luLw==",owner:"o2team",repo:"o2team.github.io",title:"Sketch 插件开发实践",body:"https://aotu.io/notes/2019/10/31/sketch-plugin/index.html\n\n在做内部设计中台 quark  项目中，协作开发了Quark for Sketch 插件打通设计物料资产沉淀，在开发过程有许多经验总结，在此分享大家。",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["pfan123"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>