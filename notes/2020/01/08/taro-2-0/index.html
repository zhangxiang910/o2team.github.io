<!DOCTYPE html><html class="theme-lattice"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Taro 2.0：拥抱社区，拥抱变化 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="format-detection" content="telephone=yes"><meta name="robots" content="index, follow"><meta baidu-gxt-verify-token="2b74a5aea155a215abea8547f929190c"><meta name="keywords" content="Taro,小程序,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2020/01/08/taro-2-0/index.html"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon-48x48.png"><link rel="manifest" href="/img/manifest.json"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" content="#2f83cd"><meta name="application-name" content="Aotu.io"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="167x167" href="/img/apple-touch-icon-167x167.png"><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon-180x180.png"><link rel="apple-touch-icon" sizes="1024x1024" href="/img/apple-touch-icon-1024x1024.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Aotu.io"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><meta name="msapplication-config" content="/img/browserconfig.xml"><meta property="wb:webmaster" content="a1686eb81db284d5"><link rel="dns-prefetch" href="//storage.360buyimg.com"><link rel="dns-prefetch" href="//img10.360buyimg.com"><link rel="dns-prefetch" href="//img11.360buyimg.com"><link rel="dns-prefetch" href="//img12.360buyimg.com"><link rel="dns-prefetch" href="//img13.360buyimg.com"><link rel="dns-prefetch" href="//img14.360buyimg.com"><link rel="dns-prefetch" href="//img20.360buyimg.com"><link rel="dns-prefetch" href="//img30.360buyimg.com"><link rel="dns-prefetch" href="//misc.aotu.io"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="缘起Taro 1.x 版本自去年 9 月份发布以来，已经陪伴大家度过了一年多的时间，在此期间 Taro 一直保持高速成长，发布了多个具有重大意义的版本，让 Taro 成为如今一个功能完善，拥有众多忠实拥趸的多端统一开发框架。  尽管 Taro 一直保持超高的迭代速度，Taro 的整体架构设计没有发生太大变化，这让 Taro 在这个时刻在变化的时代稍显佛系，且对于一个时刻想要突破自己的技术团队来说，"><meta name="keywords" content="小程序,Taro"><meta property="og:type" content="article"><meta property="og:title" content="Taro 2.0：拥抱社区，拥抱变化"><meta property="og:url" content="https://aotu.io/notes/2020/01/08/taro-2-0/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="缘起Taro 1.x 版本自去年 9 月份发布以来，已经陪伴大家度过了一年多的时间，在此期间 Taro 一直保持高速成长，发布了多个具有重大意义的版本，让 Taro 成为如今一个功能完善，拥有众多忠实拥趸的多端统一开发框架。  尽管 Taro 一直保持超高的迭代速度，Taro 的整体架构设计没有发生太大变化，这让 Taro 在这个时刻在变化的时代稍显佛系，且对于一个时刻想要突破自己的技术团队来说，"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://storage.360buyimg.com/2.0/alls.jpg"><meta property="og:image" content="https://storage.360buyimg.com/2.0/taro-cli.001.png"><meta property="og:image" content="https://storage.360buyimg.com/2.0/webpack-bundle-analyzer.jpg"><meta property="og:updated_time" content="2020-04-28T03:04:50.303Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Taro 2.0：拥抱社区，拥抱变化"><meta name="twitter:description" content="缘起Taro 1.x 版本自去年 9 月份发布以来，已经陪伴大家度过了一年多的时间，在此期间 Taro 一直保持高速成长，发布了多个具有重大意义的版本，让 Taro 成为如今一个功能完善，拥有众多忠实拥趸的多端统一开发框架。  尽管 Taro 一直保持超高的迭代速度，Taro 的整体架构设计没有发生太大变化，这让 Taro 在这个时刻在变化的时代稍显佛系，且对于一个时刻想要突破自己的技术团队来说，"><meta name="twitter:image" content="https://storage.360buyimg.com/2.0/alls.jpg"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a target="_blank" href="https://geeks.aotu.io" class="main-nav-link">极客沙龙</a></li><li class="main-nav-item"><a href="https://cases.aotu.io" class="main-nav-link">H5案例</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search" id="J_search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main typo"><article class="post"><div class="post-cover"><img src="https://img30.360buyimg.com/ling/jfs/t1/86908/10/10128/1037206/5e15a411E208aab0b/0ffac8729ebf5946.png" alt="Taro 2.0：拥抱社区，拥抱变化"></div><header class="post-hd"><h1 class="post-tit">Taro 2.0：拥抱社区，拥抱变化</h1><div class="post-meta">by <a target="_blank" href="https://github.com/luckyadam" class="post-author">隔壁老李</a> on <span>2020-01-08</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>Taro 2.0 基于 Webpack，我们可以在小程序中尝试更多的特性与技术，让小程序开发更加与业界发展同步，让 Taro 更加拥抱社区。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-content"><h2 id="缘起" class="post-heading"><a href="#缘起" class="headerlink" title="缘起"></a>缘起<a class="post-anchor" href="#缘起" aria-hidden="true"></a></h2><p>Taro 1.x 版本自去年 9 月份发布以来，已经陪伴大家度过了一年多的时间，在此期间 Taro 一直保持高速成长，发布了多个具有重大意义的版本，让 Taro 成为如今一个功能完善，拥有众多忠实拥趸的多端统一开发框架。</p><p><img src="https://storage.360buyimg.com/2.0/alls.jpg" alt></p><p>尽管 Taro 一直保持超高的迭代速度，Taro 的整体架构设计没有发生太大变化，这让 Taro 在这个时刻在变化的时代稍显佛系，且对于一个时刻想要突破自己的技术团队来说，常规性质的维护工作，显然无法安抚我们躁动的心，毕竟人的梦想，是永远不会停止的，所以我们决定启动一系列的颠覆式重构设计。</p><h2 id="2-0" class="post-heading"><a href="#2-0" class="headerlink" title="2.0"></a>2.0<a class="post-anchor" href="#2-0" aria-hidden="true"></a></h2><p>我们首先从 CLI 开始入手进行改造，大家都知道，原来 Taro CLI 的编译构建系统是自研的，整个构建系统逻辑复杂，要考虑的边际条件众多，这就导致了以下问题：</p><ul><li>维护困难，每次需要新增一个功能，例如支持解析 Markdown 文件，就需要直接改动 CLI，不够灵活</li><li>难以共建，CLI 的代码非常复杂，而且逻辑分支众多，让很多想要一起共建的人难以入手</li><li>可扩展性偏低，自研的构建系统，设计之初没有考虑到后续的扩展性，导致开发者想要添加自定义的功能无从下手</li></ul><p>基于以上问题，我们决定使用 Webpack 来实现编译构建，于是诞生了 2.0。</p><p>Taro 2.0 的 CLI 将会变得非常轻量，只会做区分编译平台、处理不同平台编译入参等操作，随后再调用对应平台的 <strong>runner 编译器</strong> 做代码编译操作，而原来大量的 AST 语法操作将会改造成 Webpack Plugin 以及 Loader，交给 Webpack 来处理。</p><p><img src="https://storage.360buyimg.com/2.0/taro-cli.001.png" alt="taro-cli 2.0"></p><p>相较于旧的构建系统，新的小程序编译带来了以下优势：</p><ul><li>利于维护，大量的逻辑交由 Webpack 来处理，我们只需要维护一些插件</li><li>更加稳定，相较于自研的构建系统，新的构建会更加稳定，降低一些奇怪错误的出现概率</li><li>可扩展性强，可以通过自行加入 Webpack Loader 与 Plugin 的方式做自己想要的扩展</li><li>各端编译统一，接入 Webpack 后，Taro 各端的编译配置可以实现非常大程度的统一</li></ul><p>可以看到新的构建系统会有很大的进步。同时，更重要的是，基于 Webpack，我们可以在小程序中尝试更多的特性与技术，例如通过 tree shaking 来优化代码包大小等等，让小程序开发更加与业界发展同步，让 Taro 更加拥抱社区。</p><h2 id="Migrate-to-2-0" class="post-heading"><a href="#Migrate-to-2-0" class="headerlink" title="Migrate to 2.0"></a>Migrate to 2.0<a class="post-anchor" href="#Migrate-to-2-0" aria-hidden="true"></a></h2><h3 id="编译配置调整" class="post-heading"><a href="#编译配置调整" class="headerlink" title="编译配置调整"></a>编译配置调整<a class="post-anchor" href="#编译配置调整" aria-hidden="true"></a></h3><p>2.0 整体上与 1.0 是完全兼容的，但是在基于 Webpack 重构后，我们对部分编译配置做了优化调整，所以如果想要将基于 1.x 的旧项目迁移至 2.0，首先需要对编译配置进行调整。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  projectName: <span class="string">'taro-framework'</span>,</span><br><span class="line">  date: <span class="string">'2019-11-2'</span>,</span><br><span class="line">  designWidth: <span class="number">750</span>,</span><br><span class="line">  deviceRatio: &#123;</span><br><span class="line">    <span class="number">640</span>: <span class="number">2.34</span> / <span class="number">2</span>,</span><br><span class="line">    <span class="number">750</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="number">828</span>: <span class="number">1.81</span> / <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  sourceRoot: <span class="string">'src'</span>,</span><br><span class="line">  outputRoot: <span class="string">'dist'</span>,</span><br><span class="line">  <span class="comment">// babel、csso、uglify 等配置从 plugins 配置中移出来</span></span><br><span class="line">  babel: &#123;</span><br><span class="line">    sourceMap: <span class="literal">true</span>,</span><br><span class="line">    presets: [[<span class="string">'env'</span>, &#123; <span class="attr">modules</span>: <span class="literal">false</span> &#125;]],,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="string">'transform-decorators-legacy'</span>,</span><br><span class="line">      <span class="string">'transform-class-properties'</span>,</span><br><span class="line">      <span class="string">'transform-object-rest-spread'</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 小程序配置从 weapp 改为 mini，可以删掉很多小配置</span></span><br><span class="line">  mini: &#123;</span><br><span class="line">    webpackChain (chain, webpack) &#123;&#125;,</span><br><span class="line">    cssLoaderOption: &#123;&#125;,</span><br><span class="line">    postcss: &#123;</span><br><span class="line">      pxtransform: &#123;</span><br><span class="line">        enable: <span class="literal">true</span>,</span><br><span class="line">        config: &#123;&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      url: &#123;</span><br><span class="line">        enable: <span class="literal">true</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">          limit: <span class="number">10240</span> <span class="comment">// 设定转换尺寸上限</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 可以删掉很多小配置</span></span><br><span class="line">  h5: &#123;</span><br><span class="line">    publicPath: <span class="string">'/'</span>,</span><br><span class="line">    staticDirectory: <span class="string">'static'</span>,</span><br><span class="line">    webpackChain (chain, webpack) &#123;&#125;,</span><br><span class="line">    postcss: &#123;</span><br><span class="line">      autoprefixer: &#123;</span><br><span class="line">        enable: <span class="literal">true</span>,</span><br><span class="line">        config: &#123;</span><br><span class="line">          browsers: [</span><br><span class="line">            <span class="string">'last 3 versions'</span>,</span><br><span class="line">            <span class="string">'Android &gt;= 4.1'</span>,</span><br><span class="line">            <span class="string">'ios &gt;= 8'</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">merge</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> merge(&#123;&#125;, config, <span class="built_in">require</span>(<span class="string">'./dev'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, config, <span class="built_in">require</span>(<span class="string">'./prod'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体编译配置请参考 <a href="https://github.com/NervJS/taro/blob/2.x/docs/config-detail.md" title="编译配置文档" target="_blank" rel="noopener">编译配置文档</a>。</p><h3 id="异步编程调整" class="post-heading"><a href="#异步编程调整" class="headerlink" title="异步编程调整"></a>异步编程调整<a class="post-anchor" href="#异步编程调整" aria-hidden="true"></a></h3><p>Taro 2.0 中开启 <code>async functions</code> 支持不再需要安装 <code>@tarojs/async-await</code>，而是直接通过 babel 插件来获得支持。</p><p>在项目根目录下安装包 <code>babel-plugin-transform-runtime</code> 和 <code>babel-runtime</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add babel-plugin-transform-runtime --dev</span><br><span class="line">$ yarn add babel-runtime</span><br></pre></td></tr></table></figure><p>随后修改项目 <a href="https://nervjs.github.io/taro/docs/config-detail.html#babel" title="babel 配置" target="_blank" rel="noopener">babel 配置</a>，配置插件 <code>babel-plugin-transform-runtime</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">babel: &#123;</span><br><span class="line">  sourceMap: <span class="literal">true</span>,</span><br><span class="line">  presets: [[<span class="string">'env'</span>, &#123; <span class="attr">modules</span>: <span class="literal">false</span> &#125;]],</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'transform-decorators-legacy'</span>,</span><br><span class="line">    <span class="string">'transform-class-properties'</span>,</span><br><span class="line">    <span class="string">'transform-object-rest-spread'</span>,</span><br><span class="line">    [<span class="string">'transform-runtime'</span>, &#123;</span><br><span class="line">      <span class="string">"helpers"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">"polyfill"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="string">"regenerator"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"moduleName"</span>: <span class="string">'babel-runtime'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="新特性尝鲜" class="post-heading"><a href="#新特性尝鲜" class="headerlink" title="新特性尝鲜"></a>新特性尝鲜<a class="post-anchor" href="#新特性尝鲜" aria-hidden="true"></a></h3><p>在基于 Webpack 改造后带来全面提升的同时，2.0 也为我们带来了以下新的特性。</p><h4 id="主编译流程钩子" class="post-heading"><a href="#主编译流程钩子" class="headerlink" title="主编译流程钩子"></a>主编译流程钩子<a class="post-anchor" href="#主编译流程钩子" aria-hidden="true"></a></h4><p>在 2.0 中，CLI 编译的主流程已经基于 <a href="https://github.com/webpack/tapable" title="Tapable" target="_blank" rel="noopener">Tapable</a> 进行改造，并且对外暴露了 <code>hooks</code> 以供使用，在 Taro 编译配置中可以通过 <code>plugins</code> 来配置编译过程插件，调用这些 <code>hooks</code> 来实现自己的需求。</p><p>目前编译主流程暴露了两个钩子 <code>beforeBuild</code> 和 <code>afterBuild</code>，其中，<code>beforeBuild</code> 将在整体编译前触发，可以获取到编译的相关配置，同时也能进行修改；<code>afterBuild</code> 将在 Webpack 编译完后执行，可以获取到编译后的结果。具体使用方式如下。</p><p>首先定义一个插件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuildPlugin</span> </span>&#123;</span><br><span class="line">  apply (builder) &#123;</span><br><span class="line">    builder.hooks.beforeBuild.tap(<span class="string">'BuildPlugin'</span>, (config) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(config)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    builder.hooks.afterBuild.tap(<span class="string">'BuildPlugin'</span>, (stats) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(stats)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来在 <code>plugins</code> 字段中进行配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  ...</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> BuildPlugin()</span><br><span class="line">  ]</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="为小程序编译添加-Loader" class="post-heading"><a href="#为小程序编译添加-Loader" class="headerlink" title="为小程序编译添加 Loader"></a>为小程序编译添加 Loader<a class="post-anchor" href="#为小程序编译添加-Loader" aria-hidden="true"></a></h4><p>我们有时候可能会面临在小程序中展示 Markdown 语法文件的需求，在 WEB 开发的时候我们可以借助 Webpack 及其 Loader，实现直接引入 <code>md</code> 文件并读取其内容，而在小程序开发中，通过借助 Taro 2.0，我们也能很轻松地实现这一需求。</p><p>一般我们会以如下的方式，来引入一个 <code>.md</code> 文件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mdTxt <span class="keyword">from</span> <span class="string">'../../some_markdown.md'</span></span><br></pre></td></tr></table></figure><p>而 <code>.md</code> 文件默认是不能直接被识别的，我们需要通过配置相应的 Loader 来实现对这类文件的加载解析，在 Taro 中可以通过 <a href="https://nervjs.github.io/taro/docs/config-detail.html#miniwebpackchain" title="mini.webpackChain" target="_blank" rel="noopener">mini.webpackChain</a> 来为小程序配置自定义 Webpack 配置，我们也可以通过它来配置 Loader。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  mini: &#123;</span><br><span class="line">    webpackChain (chain) &#123;</span><br><span class="line">      chain.merge(&#123;</span><br><span class="line">        <span class="built_in">module</span>: &#123;</span><br><span class="line">          rule: &#123;</span><br><span class="line">            myloader: &#123;</span><br><span class="line">              test: <span class="regexp">/\.md$/</span>,</span><br><span class="line">              use: [&#123;</span><br><span class="line">                loader: <span class="string">'raw-loader'</span>,</span><br><span class="line">                options: &#123;&#125;</span><br><span class="line">              &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="为小程序编译添加-Plugin" class="post-heading"><a href="#为小程序编译添加-Plugin" class="headerlink" title="为小程序编译添加 Plugin"></a>为小程序编译添加 Plugin<a class="post-anchor" href="#为小程序编译添加-Plugin" aria-hidden="true"></a></h4><p>当我们要把打包后的小程序进行发布的时候，可能会遇到小程序过大的问题，那么我们肯定迫切希望可以看到到底是哪些文件的大小造成了这个影响，我们可以通过使用 <a href="https://www.npmjs.com/package/webpack-bundle-analyzer" title="webpack-bundle-analyzer" target="_blank" rel="noopener">webpack-bundle-analyzer</a> 插件对打包体积进行分析。</p><p>在 <a href="https://nervjs.github.io/taro/docs/config-detail.html#miniwebpackchain" title="mini.webpackChain" target="_blank" rel="noopener">mini.webpackChain</a> 中添加如下配置。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  mini: &#123;</span><br><span class="line">    webpackChain (chain, webpack) &#123;</span><br><span class="line">      chain.plugin(<span class="string">'analyzer'</span>)</span><br><span class="line">        .use(<span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin, [])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在运行之后，我们就能在浏览器里看到如下分析效果。</p><p><img src="https://storage.360buyimg.com/2.0/webpack-bundle-analyzer.jpg" alt="webpack-bundle-analyzer"></p><h4 id="Taro-RN-依赖升级到-0-59-9" class="post-heading"><a href="#Taro-RN-依赖升级到-0-59-9" class="headerlink" title="Taro RN 依赖升级到 0.59.9"></a>Taro RN 依赖升级到 0.59.9<a class="post-anchor" href="#Taro-RN-依赖升级到-0-59-9" aria-hidden="true"></a></h4><p>在 2.0 中我们将 RN 端 React 依赖升级到 16.8.0，React Native 依赖升级到 0.59.9。主要原因：</p><ul><li>Google 要求所有 <a href="https://play.google.com/" title="Google Play" target="_blank" rel="noopener">Google Play</a> 应用支持 64 位 so 库，而现有 RN 0.55.4 依无法支持 64 位库，为配合 64 位升级，Taro RN 端的 React Native 依赖需要同步升级</li><li>React 16.8.0 是第一个支持 Hook 的版本，React Native 从 0.59 版本开始支持 Hook，此前社区一直在呼吁对 RN 0.55.4 进行升级以直接支持 Hook 的写法</li></ul><p>本次 RN 端属于无缝升级，原有的写法和配置均不变，如果使用 <a href="https://github.com/NervJS/taro-native-shell" title="taro-native-shell" target="_blank" rel="noopener">taro-native-shell</a> 的，选择 0.59.9 分支即可；在原生应用集成 RN 的，需要自行升级 React Native 依赖到 0.59.9。</p><h2 id="未来与展望" class="post-heading"><a href="#未来与展望" class="headerlink" title="未来与展望"></a>未来与展望<a class="post-anchor" href="#未来与展望" aria-hidden="true"></a></h2><p>正如前文所提到的，Taro 2.0 只是一个开始。</p><p>在 10 年代最后一场 GMTC 全球大前端技术大会上，Taro 团队向大家展示了 小程序跨框架开发的探索与实践 的艰辛旅程，同时也提前曝光了正在紧密开发中的 <a href="https://github.com/NervJS/taro/tree/next" title="Taro Next" target="_blank" rel="noopener">Taro Next</a>。</p><p>那是一个完全区别于以往的版本，一条与现在 Taro 截然不同的道路，预示着 Taro 正在革自己的命。</p><p>节物风光不相待，桑田碧海须臾改。</p><p>20 年代呼啸而来，下一个 10 年，很多框架都会死去，很多技术也会焕然而生，没有什么是不变的，唯一不变的只有变化，我们能做的也只能是拥抱变化。</p><div class="post-tags" style="display:none"><a href="/tags/小程序/">小程序</a> <a href="/tags/Taro/">Taro</a></div><div class="post-categories" style="display:none"><a href="/cates/Web开发/">Web开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2020/01/08/taro-2-0/">https://aotu.io/notes/2020/01/08/taro-2-0/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2020-04-28T03:04:50.303Z">上次更新：2020-04-28 11:04:50</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2020/02/03/taro-next-alpha/" title="Taro Next 发布预览版：同时支持 React / Vue / Nerv">Taro Next 发布预览版：同时支持 React / Vue / Nerv <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2020/01/02/gmtc/" title="GMTC |《小程序跨框架开发的探索与实践》演讲全文"><i class="fa fa-chevron-left"></i> GMTC |《小程序跨框架开发的探索与实践》演讲全文</a></div></div><div class="post-comments" id="comments"></div><script>var gitalkOpts={id:"bm90ZXMvMjAyMC8wMS8wOC90YXJvLTItMC8=",owner:"o2team",repo:"o2team.github.io",title:"Taro 2.0：拥抱社区，拥抱变化",body:"https://aotu.io/notes/2020/01/08/taro-2-0/index.html\n\nTaro 2.0 基于 Webpack，我们可以在小程序中尝试更多的特性与技术，让小程序开发更加与业界发展同步，让 Taro 更加拥抱社区。",clientID:"3c4d153e6874260f9c7e",clientSecret:"dd44012504c6168bc05b9266e0554bb28c62ce15",admin:["luckyadam"]}</script></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//taro.jd.com" target="_blank" title="Taro">Taro</a></li><li><a href="//taro-ui.jd.com" target="_blank" title="Taro-UI">Taro-UI</a></li><li><a href="//taro-ext.jd.com" target="_blank" title="Taro 物料市场">Taro 物料市场</a></li><li><a href="//taro-club.jd.com" target="_blank" title="Taro 官方论坛">Taro 官方论坛</a></li><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li><li><a href="//xcel.aotu.io" target="_blank" title="Excel Filter">Excel Filter</a></li><li><a href="//aotu.jd.com/share/" target="_blank" title="凹凸公开课">凹凸公开课</a></li><li><a href="//at.aotu.io" target="_blank" title="AT-UI">AT-UI</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://www.cloudbase.net" target="_blank" title="小程序·云开发"><img style="width:22px;vertical-align:middle" src="https://img20.360buyimg.com/ling/jfs/t1/57175/5/15617/50216/5dca6729E00cdff5d/631622525425290e.png">小程序·云开发</a></li><li><a href="https://ling.jd.com" target="_blank" title="京东羚珑智能设计">羚珑智能设计</a></li><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://dopro.io/" target="_blank" title="腾讯 Deep Ocean">Deep Ocean</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li><li><a href="https://uiiiuiii.com/" target="_blank" title="优优教程网">优优教程网</a></li><li><a href="https://www.designup.cn/" target="_blank" title="Designup">Designup</a></li><li><a href="http://eux.baidu.com/" target="_blank" title="百度EUX">百度EUX</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2020. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/post_wx_share.js"></script><script src="/js/bundle/gitalk.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=53685723" charset="UTF-8"></script></body></html>